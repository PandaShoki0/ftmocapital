import{_,Y as b,r as k,o as d,c as l,a as s,t as c,i as x,w as v,g as w,F as m,d as I,n as h,f as M,q as p,h as f,X as S,v as L,B as T,C}from"./bootstrap-9979bcf7.js";import"./_commonjsHelpers-de833af9.js";import"./browser-77dd377d.js";import"./preload-helper-f61836a9.js";import"./axios-4a70c6fc.js";const U={data(){return{ticket:[],chatTitle:"",newMessage:"",messages:[],uploadedImageUrl:"",showingLargeImage:!1,largeImageUrl:"",isMouseOverImage:!1}},created(){this.loadTicket()},methods:{showLargeImage(a){const e=this.extractImageUrl(a);e&&(this.showingLargeImage=!0,this.largeImageUrl=e)},hideLargeImage(){this.showingLargeImage=!1},extractImageUrl(a){const e=document.createElement("div");e.innerHTML=a;const t=e.querySelector("img");return t?t.src:""},async uploadImage(a){const e=a.target.files[0];if(e){const t=new FormData;t.append("image",e);try{const o=await axios.post("/user/support/tickets/upload-image",t,{headers:{"Content-Type":"multipart/form-data"}});o.status==="success"?(this.uploadedImageUrl=o.image_url,this.sendImage()):this.$toast.error(o.message)}catch(o){console.error(o)}}},sendImage(){if(this.uploadedImageUrl){const a={ticket_id:this.ticket.id,sender_name:this.ticket.user.username,type:"image",content:`<img src="${this.uploadedImageUrl}" class="uploaded-image" />`,timestamp:new Date().toISOString()};axios.post(`/user/support/tickets/${this.ticket.id}/send`,{data:a}),this.uploadedImageUrl="",this.$nextTick(()=>{const e=this.$el.querySelectorAll(".uploaded-image"),t=e[e.length-1];t&&t.addEventListener("click",this.expandImage)})}},expandImage(a){const e=a.target;e.classList.toggle("expanded"),e.classList.contains("expanded")?(e.style.maxWidth="90%",e.style.cursor="zoom-out"):(e.style.maxWidth="100%",e.style.cursor="zoom-in")},async loadTicket(){await axios.get(`/user/support/tickets/${this.$route.params.id}/messages`).then(o=>{o.type=="success"?(this.ticket=o.ticket,this.messages=Array.isArray(o.ticket.messages)?o.ticket.messages:[]):(this.$toast.error(o.message),this.$router.push("/support"))}).catch(o=>{console.error(o)});const a=new b(PUSHER_APP_KEY,{cluster:PUSHER_APP_CLUSTER,forceTLS:!0,authEndpoint:"/user/pusher/auth",auth:{headers:{"X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},beforeSend:function(o){o.setRequestHeader("X-CSRF-Token",document.querySelector('meta[name="csrf-token"]').getAttribute("content"))}}}),e=`support-private-chat-${this.ticket.id}`;a.subscribe(e).bind("new_message",o=>{this.messages.push(o)}),this.chatTitle=`Ticket #${this.ticket.id}`},messageClass(a){return a===this.ticket.user_id?"my-message text-right":"other-message text-left"},sendMessage(){if(this.newMessage.trim()==="")return;const a={ticket_id:this.ticket.id,sender_name:this.ticket.user.username,content:this.newMessage.trim(),type:"text",timestamp:new Date().toISOString()};Array.isArray(this.messages)||(this.messages=[]),axios.post(`/user/support/tickets/${this.ticket.id}/send`,{data:a}),this.newMessage=""},formatDate(a){const e=Math.floor((new Date-a)/1e3);let t=Math.floor(e/31536e3);return t>=1?`${t} year${t===1?"":"s"} ago`:(t=Math.floor(e/2592e3),t>=1?`${t} month${t===1?"":"s"} ago`:(t=Math.floor(e/86400),t>=1?`${t} day${t===1?"":"s"} ago`:(t=Math.floor(e/3600),t>=1?`${t} hour${t===1?"":"s"} ago`:(t=Math.floor(e/60),t>=1?`${t} minute${t===1?"":"s"} ago`:"just now"))))}}},g=a=>(T("data-v-cd59216e"),a=a(),C(),a),A={class:"mb-5 flex justify-between"},D={class:"text-xl font-semibold text-gray-700 dark:text-gray-200"},P=g(()=>s("i",{class:"bi bi-chevron-left"},null,-1)),E={class:"card pt-4"},$={ref:"chatMessages",class:"card-body flex-grow overflow-y-auto px-4 pb-4 dark:bg-gray-800"},q={key:0,class:"space-y-3"},F={class:"meta mb-1 text-sm text-gray-500 dark:text-gray-400"},H={key:0,class:"sender mr-2"},N={class:"timestamp"},R={key:0},z={class:"image-container"},B=["innerHTML"],O=["onClick"],V=g(()=>s("i",{class:"bi bi-zoom-in zoom-icon"},null,-1)),j=[V],X={key:1},W={key:1},Y={class:"card-body flex-grow space-y-4 overflow-y-auto px-4 pb-4 dark:bg-gray-800"},K={class:"text-center text-gray-500 dark:text-gray-200"},G={class:"mt-2"},J=g(()=>s("label",{for:"image-upload",class:"text-gray-500 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"},[s("i",{class:"bi bi-image"})],-1)),Q={class:"relative w-full ml-4"},Z=g(()=>s("button",{type:"submit",class:"text-white absolute right-2.5 bottom-2.5 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium text-sm dark:focus:ring-blue-800 hover:text-blue-500"},[s("i",{class:"bi bi-send"})],-1)),ee={key:1,class:"card-footer"},te={class:"relative flex items-center"},se={class:"text-gray-500 dark:text-gray-200"},ae=["src"];function re(a,e,t,o,i,n){const y=k("router-link");return d(),l(m,null,[s("div",A,[s("h3",D,c(i.chatTitle),1),x(y,{to:"/support",class:"btn btn-outline-secondary"},{default:v(()=>[P,w(" "+c(a.$t("Back")),1)]),_:1})]),s("div",E,[s("div",$,[i.messages!=null&&i.messages.length>0?(d(),l("div",q,[(d(!0),l(m,null,I(i.messages,r=>(d(),l("div",{key:r.id},[s("div",{class:h(n.messageClass(r.sender_id))},[s("div",F,[r.sender_id!==i.ticket.user_id?(d(),l("span",H,c(r.sender_name),1)):M("",!0),s("span",N,c(n.formatDate(r.timestamp)),1)]),s("div",{class:h(["content max-w-3/4 inline-block break-words px-4 py-2 shadow-md",r.sender_id===i.ticket.user_id?"rounded-tl-lg rounded-b-lg bg-blue-500 text-white":"rounded-tr-lg rounded-b-lg bg-gray-300 text-gray-700"])},[r.type==="image"?(d(),l("div",R,[s("div",z,[s("div",{class:"image-wrapper",ref_for:!0,ref:"messageImage",onMouseover:e[0]||(e[0]=u=>i.isMouseOverImage=!0),onMouseout:e[1]||(e[1]=u=>i.isMouseOverImage=!1),innerHTML:r.content},null,40,B),s("div",{class:"overlay",onClick:u=>n.showLargeImage(r.content)},j,8,O)])])):(d(),l("div",X,c(r.content),1))],2)],2)]))),128))])):(d(),l("div",W,[s("div",Y,[s("div",K,c(a.$t("No Messages Found!")),1)])]))],512),i.ticket.status!=3?(d(),l("form",{key:0,class:"card-footer flex items-center justify-between",onSubmit:e[4]||(e[4]=p((...r)=>n.sendMessage&&n.sendMessage(...r),["prevent"]))},[s("div",G,[J,s("input",{type:"file",id:"image-upload",class:"hidden",onChange:e[2]||(e[2]=(...r)=>n.uploadImage&&n.uploadImage(...r))},null,32)]),s("div",Q,[f(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>i.newMessage=r),type:"text",class:"block w-full p-3 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Type a message..."},null,512),[[S,i.newMessage]]),Z])],32)):(d(),l("div",ee,[s("div",te,[s("div",se,c(a.$t("This ticket has been closed")),1)])]))]),f(s("div",{class:"large-image-overlay",onClick:e[6]||(e[6]=(...r)=>n.hideLargeImage&&n.hideLargeImage(...r))},[s("img",{src:i.largeImageUrl,class:"large-image"},null,8,ae),s("button",{class:"close-btn absolute top-0 right-0 text-white text-2xl focus:outline-none px-3 py-1 m-1 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 hover:dark:bg-gray-800",onClick:e[5]||(e[5]=p((...r)=>n.hideLargeImage&&n.hideLargeImage(...r),["stop"]))}," Ã— ")],512),[[L,i.showingLargeImage]])],64)}const ce=_(U,[["render",re],["__scopeId","data-v-cd59216e"]]);export{ce as default};
