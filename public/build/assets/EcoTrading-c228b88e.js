import{a as le,M as ce}from"./Markets-4d84e3d5.js";import{u as de}from"./market-8ae68380.js";import{_ as D,r as F,o as m,c as f,a,q as $,n as T,F as q,d as J,t as h,e as N,f as I,b as ue,U as he,bT as me,k as H,l as B,x as R,y as ie,i as p,w as v,g as O,I as pe,bf as ye}from"./bootstrap-26bee35b.js";import{d as oe}from"./datafeed-d62ae98f.js";import{C as re}from"./flowbite-vue-a1a41228.js";import{u as be}from"./user-7d9b5f4d.js";import{A as ge,T as fe,P as ke}from"./PriceInput-32e20367.js";import{t as _e}from"./toMoney-6259e3a7.js";import{t as ve}from"./toDate-6e0d13f3.js";import{F as xe}from"./Filter-8923840e.js";import{C as we}from"./Col-c267595d.js";import{L as Se}from"./ListItem-eb946da8.js";/* empty css                                                                       */import"./_commonjsHelpers-de833af9.js";import"./browser-77dd377d.js";import"./preload-helper-f61836a9.js";import"./axios-4a70c6fc.js";const Ae={components:{MarketList:le},props:["type","subtype"],setup(){return{marketStore:de()}},data(){return{old:[],markets:[],ext,activeItem:"fav"}},created(){this.fetchMarkets(),this.fetchFavs()},mounted(){},methods:{fetchMarkets(){axios.get("/user/eco/markets").then(e=>{this.markets=e.markets})},async fetchFavs(){this.marketStore.favs.length==0&&await this.marketStore.fetch_favs()},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e},scrollLeft(){const e=document.querySelector(".nf"),s=e.scrollLeft;e.scroll({left:s-200,behavior:"smooth"})},scrollRight(){const e=document.querySelector(".nf"),s=e.scrollLeft;e.scroll({left:s+200,behavior:"smooth"})},addToWatchlist(e,s,t){axios.post("/user/watchlist/store",{currency:e,pair:s,type:t}).then(r=>{this.$toast[r.type](r.message),this.fetchFavs()}).catch(r=>{this.$toast.error(r.response.data)})},removeFromWatchlist(e){axios.post("/user/watchlist/delete",{id:e}).then(s=>{this.$toast.success(s.message),this.fetchFavs()}).catch(s=>{this.$toast.error("Market Already Removed From Watchlist")})},contains(e,s){var t=0;return s.forEach(function(r){t=t+e.includes(r)}),t===1},formatTotal(e){return ccxt.decimalToPrecision(e,ccxt.ROUND,3,ccxt.DECIMAL_PLACES,ccxt.PAD_WITH_ZERO)}}},Fe={class:"Markets border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},Te={class:"mb-4 flex border-gray-200 dark:border-gray-800"},Be=a("i",{class:"bi bi-chevron-left text-warning"},null,-1),Ce=[Be],Oe={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden bg-gray-200 text-center text-sm font-medium dark:bg-gray-800",role:"tablist"},Me=a("i",{class:"bi bi-star bi-icon"},null,-1),Pe=[Me],Ie=["onClick"],Ne=a("i",{class:"bi bi-chevron-right text-warning fs-6"},null,-1),$e=[Ne],De={id:"myTabContent",class:"px-3"};function Ee(e,s,t,r,d,o){const n=F("MarketList");return m(),f("div",Fe,[a("div",Te,[a("button",{class:"-mb-px bg-gray-200 px-1 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700",onClick:s[0]||(s[0]=$(l=>o.scrollLeft(),["prevent"]))},Ce),a("ul",Oe,[a("li",null,[a("small",null,[a("a",{class:T(["inline-block px-2 py-1 text-gray-600 dark:text-gray-300",o.isActive("fav")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),onClick:s[1]||(s[1]=l=>o.setActive("fav"))},Pe,2)])]),(m(!0),f(q,null,J(d.markets,(l,y,_)=>(m(),f("li",{key:_},[a("small",null,[a("a",{class:T(["inline-block px-2 py-1 text-gray-600 dark:text-gray-300",o.isActive(y)?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),onClick:S=>o.setActive(y)},h(y),11,Ie)])]))),128))]),a("button",{class:"-mb-px bg-gray-200 px-1 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700",onClick:s[2]||(s[2]=$(l=>o.scrollRight(),["prevent"]))},$e)]),a("div",De,[d.activeItem==="fav"?(m(),N(n,{key:r.marketStore.favs.length,list:Object.values(r.marketStore.favs),type:t.type,subtype:t.subtype,iffav:"true",ifeco:"true",onFetchFavs:s[3]||(s[3]=l=>r.marketStore.fetch_favs())},null,8,["list","type","subtype"])):I("",!0),(m(!0),f(q,null,J(d.markets,(l,y,_)=>(m(),f("div",{key:_,class:T(o.isActive(y)?"":"hidden")},[d.activeItem===y?(m(),N(n,{key:l.length,list:Object.values(l),type:t.type,subtype:t.subtype,ifeco:"true",onFetchFavs:s[4]||(s[4]=S=>r.marketStore.fetch_favs())},null,8,["list","type","subtype"])):I("",!0)],2))),128))])])}const Le=D(Ae,[["render",Ee]]),We={props:{market:{type:Object,required:!0},precisionAmount:{type:[Number,String],required:!0,default:6},precisionPrice:{type:[Number,String],required:!0,default:6}},data(){return{sideLength:12,activeItem:"marketTrades",trades:[],subscriptionOrderBook:null}},computed:{visibleTrades(){return this.trades.slice(0,this.sideLength)},currency(){return this.market.currency},pair(){return this.market.pair}},watch:{currency:{handler(){this.updateWebSocketSubscription()}},pair:{handler(){this.updateWebSocketSubscription()}},$route(e,s){this.updateWebSocketSubscription()}},beforeUnmount(){this.disconnectWebSocket()},mounted(){this.updateWebSocketSubscription()},methods:{isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e},tabClass(e){return this.isActive(e)?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"},priceFormatter(e,s=8,t=2,r=","){return e?(e=parseInt(e)!==0?parseFloat(e).toFixed(t):parseFloat(e).toFixed(s),e=parseInt(e)!==0?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,r):e,e):0},tradeColor(e){return e==="SELL"?"rgb(246,70,93)":"rgb(14,203,129)"},updateWebSocketSubscription(){this.subscriptionOrderBook&&(this.subscriptionOrderBook.stopListening(".orderbook"),window.Echo.leave(this.subscriptionOrderBook.name),this.subscriptionOrderBook=null);const e=`orderbook-data.${this.currency}.${this.pair}`;this.subscriptionOrderBook=window.Echo.private(e),this.subscriptionOrderBook.listen(".orderbook",async s=>{this.trades.unshift(s.orderbook),this.trades=this.trades.slice(0,this.sideLength)})},disconnectWebSocket(){this.subscriptionOrderBook&&(this.subscriptionOrderBook.stopListening(".orderbook"),window.Echo.leave(this.subscriptionOrderBook.name),this.subscriptionOrderBook=null)},formatTime(e){return new Date(e).toLocaleTimeString("en-US")}}},Ue={class:"Trades border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},ze={class:"w-full bg-gray-200 dark:bg-gray-800"},Ve={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden text-center",role:"tablist"},He={id:"tradesContent"},Re={class:"table-responsive"},qe={class:"text-dark table-sm table"},je={class:"text-muted"},Ke={class:"text-start",scope:"col"},Ye={class:"text-end",scope:"col"},Ze={class:"text-end",scope:"col"},Ge={id:"tradeTable",class:"trade"},Je={class:"text-end"},Qe={class:"text-end"};function Xe(e,s,t,r,d,o){return m(),f("div",Ue,[a("div",ze,[a("ul",Ve,[a("li",null,[a("a",{id:"marketTrades-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.tabClass("marketTrades")]),type:"button",role:"tab","aria-controls":"marketTrades","aria-selected":"false",onClick:s[0]||(s[0]=$(n=>o.setActive("marketTrades"),["prevent"]))},h(e.$t("Market Trades")),3)])])]),a("div",He,[a("div",{id:"marketTrades",class:T(["px-3 pt-3",{hidden:!o.isActive("marketTrades")}])},[a("div",Re,[a("table",qe,[a("thead",je,[a("tr",null,[a("th",Ke,h(e.$t("Price")),1),a("th",Ye,h(e.$t("Amount")),1),a("th",Ze,h(e.$t("Time")),1)])]),a("tbody",Ge,[(m(!0),f(q,null,J(o.visibleTrades,(n,l)=>(m(),f("tr",{key:l},[a("td",{class:"text-start",style:ue({color:o.tradeColor(n.type)})},h(o.priceFormatter(n.price,t.precisionPrice)),5),a("td",Je,h(o.priceFormatter(n.amount,t.precisionAmount)),1),a("td",Qe,h(o.formatTime(n.created)),1)]))),128))])])])],2)])])}const et=D(We,[["render",Xe]]),j=he("eco",{state:()=>({marketOrder:!1,bestAsk:0,bestBid:0,market:[],open_orders:[],closed_orders:[],walletSymbol:null,walletCurrency:null,loading:!1,timeframe:localStorage.getItem("lastTimeframe")||"HOUR_1",precisionAmount:6,precisionPrice:6}),actions:{async fetch(e,s){await axios.post("/user/eco/index",{currency:e,pair:s}).then(t=>{t.message=="Verify your identify first!"&&(window.location.href="/user/kyc"),this.market=t})},async fetchOrders(){await axios.post("/user/eco/orders",{currency:this.market.currency,currency_chain:this.market.currency_chain,pair:this.market.pair,pair_chain:this.market.pair_chain}).then(e=>{this.open_orders=e.open_orders,this.closed_orders=e.closed_orders,this.open_orders.errorCode&&this.fetchOrders()}).catch(e=>{})},closeModal(){this.isShowModal=!1},showModal(){this.isShowModal=!0},async fetchWallets(){this.fetchWallet(this.market.currency,this.market.currency_chain),this.fetchWallet(this.market.pair,this.market.pair_chain)},async fetchWallet(e,s){await axios.post("/user/eco/wallet/balance",{symbol:e.includes("_")?e.substring(0,e.indexOf("_")):e,postfix:e.includes("_")?e.substring(e.indexOf("_")):null,chain:s}).then(t=>{e==this.market.currency?this.walletSymbol=t.balance:e==this.market.pair&&(this.walletCurrency=t.balance)}).catch(t=>{this.fetchWallet(e.includes("_")?e.substring(0,e.indexOf("_")):e,s)})},async createWallet(e,s){this.loading=!0,await axios.post("/user/eco/wallet/store",{chain:s,network:s,symbol:e.includes("_")?e.substring(0,e.indexOf("_")):e,postfix:e.includes("_")?e.substring(e.indexOf("_")):null}).then(t=>{Array.isArray(t)?t.forEach(r=>{$toast[r.type](r.message)}):$toast[t.type](t.message),this.fetchWallet(e,s)}).catch(t=>{$toast.error(t.response.data.message)}).finally(()=>{this.loading=!1})},async executeTrade(e,s,t,r){this.loading=!0;const d=s==="market",o=e==="BUY";if(d&&(o?this.bestAsk:this.bestBid)>0||!d&&t>0)await axios.post("/user/eco/trade/store",{amount:Number.parseFloat(r),price:d?o?Number.parseFloat(this.bestAsk):Number.parseFloat(this.bestBid):Number.parseFloat(t),symbol:this.market.currency,symbol_chain:this.market.currency_chain,currency:this.market.pair,currency_chain:this.market.pair_chain,tradeType:s,type:e,taker:o?this.market.taker:void 0,maker:o?void 0:this.market.maker,timeframe:this.timeframe}).then(n=>{if(n.messages)n.message.forEach(l=>{$toast[n.type](l)});else{$toast[n.type](n.message),this.fetchOrders();const l=Number.parseFloat(r),y=d?o?Number.parseFloat(this.bestAsk):Number.parseFloat(this.bestBid):Number.parseFloat(t);o?this.walletCurrency-=l*y:this.walletSymbol-=l,this.fetchWallets()}}).catch(n=>{console.log(n)}).finally(()=>{this.loading=!1});else{const n=d?o?"No Market Price, Please Do Limit Order":"Please wait for orderbook to load":"Please set a valid price";$toast.error(n),this.loading=!1}}},persist:!0}),tt={name:"KLineWidget",props:{market:{type:Object,required:!0}},setup(){return{ecoStore:j()}},data(){return{chart:null,bars:[],loops:{},cachedData:{},interval:localStorage.getItem("lastInterval")||"1h",widget:null,duration:864e5,now:Date.now(),lastprice:[],subscription:null,supported_resolutions:["1","3","5","15","30","60","240","720","D","W","M"],intervalMap:{"1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","4h":"240","12h":"720","1d":"D",w:"W",m:"M"},intervalFetch:{"1m":"MIN_1","3m":"MIN_3","5m":"MIN_5","15m":"MIN_15","30m":"MIN_30","1h":"HOUR_1","4h":"HOUR_4","12h":"HOUR_12","1d":"DAY",w:"WEEK",m:"MONTH"}}},computed:{datafeed(){return this.createDataFeed()}},watch:{async $route(e,s){const t=`${s.params.symbol}-${s.params.currency}-${this.intervalFetch[this.interval]}`,r=`${e.params.symbol}-${e.params.currency}-${this.intervalFetch[this.interval]}`;this.loops[t]=!1,this.bars=[],await this.$nextTick(),this.loops[r]=!0,this.datafeed=this.createDataFeed(),this.updateWebSocketSubscription(),this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[this.interval])},interval:{handler:async function(e,s){if(e!==s){const t=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[s]}`,r=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[e]}`;this.loops[t]=!1,this.bars=[],await this.$nextTick(),this.loops[r]=!0,this.datafeed=this.createDataFeed(),this.ecoStore.timeframe=this.intervalFetch[e],localStorage.setItem("lastInterval",e),localStorage.setItem("lastTimeframe",this.intervalFetch[e]),this.updateWebSocketSubscription(),this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[e])}},immediate:!1}},beforeUnmount(){Object.keys(this.loops).forEach(e=>{this.loops[e]=!1})},mounted(){this.initTradingView()},created(){this.updateWebSocketSubscription();const e=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[this.interval]}`;this.loops[e]=!0},methods:{updateWebSocketSubscription(){this.subscription&&(this.subscription.stopListening(".candlestick"),window.Echo.leave(this.subscription.name),this.subscription=null);const e=`chart-data.${this.market.currency}.${this.market.pair}.${this.intervalFetch[this.interval]}`;this.subscription=window.Echo.private(e),this.subscription.listen(".candlestick",async s=>{for(const t of s.chartData){const r={timestamp:t.timestamp,high:parseFloat(t.high),low:parseFloat(t.low),open:parseFloat(t.open),close:parseFloat(t.close),volume:parseFloat(t.volume)};await this.updateBar(r)}})},async loopHistory(e,s,t){const r=`${e}-${s}-${t}`,d=this.getBarDuration(this.intervalMap[this.interval]),o=199;let n;this.bars&&this.bars.length>0?n=this.bars[0].time:n=Date.now()-o*d;let l=0;const y=10;for(;!this.stopLoop&&this.loops[r];){const _=n-o*d,S=await this.fetchHistory(_,n);S&&S.length==0?l++:l=0,l>=y&&(this.stopLoop=!1),n=_,await new Promise(C=>setTimeout(C,5e3))}},async fetchHistory(e,s){if(e!=null&&!isNaN(e)&&s!=null&&!isNaN(s))try{return await axios.get(`/user/eco/chart/${this.market.currency}/${this.market.pair}/${this.intervalFetch[this.interval]}/${e}/${s}`).then(r=>Object.values(r))}catch{return[]}else return[]},async fetchOHLCV(){return await axios.get(`/user/eco/chart/${this.market.currency}/${this.market.pair}/${this.intervalFetch[this.interval]}/json`).then(s=>s).catch(s=>{throw s})},async getBars(e){var s=this.market.currency+"/"+this.market.pair;if(!e.firstDataRequest)return{bars:[],meta:{noData:!0}};if(e.resolution!==this.intervalMap[this.interval])for(let l in this.intervalMap)this.intervalMap[l]===e.resolution&&(this.interval=l);const t=await this.fetchOHLCV(s);if(this.createEmptyBars(),!t||!t.length)return{bars:[],meta:{noData:!0}};t.sort((l,y)=>l.timestamp-y.timestamp);const r=[];let d=0;const o=Date.now(),n=this.getBarDuration(e.resolution);for(let l=0;l<t.length;l++){const y=t[l];if(y.timestamp===void 0)continue;if(y.timestamp===d&&(y.timestamp+=1),d!==0)for(let S=d+n;S<y.timestamp;S+=n){const C=r[r.length-1],A={time:S,open:C.close,high:C.close,low:C.close,close:C.close,volume:0};r.push(A)}const _={time:y.timestamp,open:d===0?parseFloat(y.open):r[r.length-1].close,high:parseFloat(y.high),low:parseFloat(y.low),close:parseFloat(y.close),volume:parseFloat(y.volume)};r.push(_),d=y.timestamp}for(let l=d+n;l<o;l+=n){const y=r[r.length-1],_={time:l,open:y.close,high:y.close,low:y.close,close:y.close,volume:0};r.push(_)}return r.sort((l,y)=>l.time>y.time?1:-1),this.bars=r,window.location.href.indexOf(this.market.currency+"-"+this.market.pair)>-1&&this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[this.interval]),{bars:r,meta:{noData:!r.length}}},async createEmptyBars(){const e=async()=>{if(window.location.href.indexOf(this.market.currency+"-"+this.market.pair)>-1){const s=this.bars.some(t=>t.volume!==0);try{const t=Date.now(),r=this.getBarDuration(this.intervalMap[this.interval]),d=Math.floor(t/r)*r;if(!s&&this.bars.length===0){const o={time:d,open:this.ecoStore.bestAsk||0,high:this.ecoStore.bestAsk||0,low:this.ecoStore.bestAsk||0,close:this.ecoStore.bestAsk||0,volume:0};this.datafeed.updateKLine(o),this.bars.push(o)}else if(this.bars.length>0&&s){const o=this.bars[this.bars.length-1];if(t>o.time+r){const n={time:o.time+r,open:o.close,high:o.close,low:o.close,close:o.close,volume:0};this.datafeed.updateKLine(n),this.bars.push(n)}}setTimeout(e,1e3)}catch(t){console.log(t)}}};e()},async updateBar(e){const s=this.bars[this.bars.length-1],t=this.getBarDuration(this.intervalMap[this.interval]),r=s.time-s.time%t;if(e.timestamp>=r&&e.timestamp<r+t)s.high=Math.max(s.high,parseFloat(e.high)),s.low=Math.min(s.low,parseFloat(e.low)),s.close=parseFloat(e.close),s.volume+=parseFloat(e.volume),this.datafeed.updateKLine(s);else if(e.timestamp>s.time){const o={time:e.timestamp,open:s.close,high:parseFloat(e.high),low:parseFloat(e.low),close:parseFloat(e.close),volume:parseFloat(e.volume)};this.datafeed.updateKLine(o),this.bars.push(o)}},createDataFeed(){return new oe.DataFeed({getBars:e=>this.getBars(e),fetchResolveSymbol:()=>this.resolveSymbol(),fetchConfiguration:()=>new Promise(e=>{e({supported_resolutions:this.supportedResolutions})})})},resolveSymbol(){return new Promise(e=>{var s=this.market.currency+"/"+this.market.pair;e({ticker:s,name:s,full_name:s,description:s,type:"crypto",session:"24x7",exchange:gnl.sitename.toUpperCase(),listed_exchange:gnl.sitename.toUpperCase(),timezone:"Etc/UTC",format:"price",minmov:1,has_intraday:!0,supported_resolutions:this.supported_resolutions,volume_precision:2,data_status:"streaming",pricescale:100})})},getBarDuration(e){switch(e){case"1":return 60*1e3;case"3":return 3*60*1e3;case"5":return 5*60*1e3;case"15":return 15*60*1e3;case"30":return 30*60*1e3;case"60":return 60*60*1e3;case"240":return 4*60*60*1e3;case"720":return 12*60*60*1e3;case"D":return 24*60*60*1e3;case"W":return 7*24*60*60*1e3;case"M":return 30*24*60*60*1e3;default:return 60*1e3}},getRandomInt(e,s){return e=Math.ceil(e),s=Math.floor(s),Math.floor(Math.random()*(s-e))+e},initTradingView(){const e=document.getElementById("tv_chart_container");e&&e.remove();const s=document.createElement("div");s.id="tv_chart_container",s.style.height="100%",document.querySelector("#creatable").appendChild(s);var r=this.market.currency+"/"+this.market.pair;this.widget=new oe.widget({fullscreen:!1,width:"100%",height:"100%",symbol:r,interval:this.intervalMap[this.interval],container_id:"tv_chart_container",datafeed:this.datafeed,library_path:"/charting_library/",locale:"en",theme:theme=="dark"?"Dark":"Light",timezone:"Etc/UTC",allow_symbol_change:!1,charts_storage_api_version:"1.1",client_id:"tradingview.com",user_id:"public_user_id",disabled_features:["header_compare","study_dialog_search_control","symbol_search_hot_key","header_symbol_search","go_to_date","compare_symbol","timezone_menu","timeframes_toolbar","header_screenshot"],enabled_features:["dont_show_boolean_study_arguments","use_localstorage_for_settings","save_chart_properties_to_local_storage","side_toolbar_in_fullscreen_mode","hide_last_na_study_output","constraint_dialogs_movement","hide_left_toolbar_by_default"]}),this.widget.onChartReady(()=>{this.chart=this.widget.chart()})}}};function rt(e,s,t,r,d,o){return null}const st=D(tt,[["render",rt]]);function at(e){return Math.floor(e.valueOf())===e.valueOf()?0:e.toString().split(".")[1].length||0}const ot={components:{Button:re,AmountInput:ge,TotalInput:fe,PriceInput:ke},props:{orderType:String,formType:String},setup(e){const{t:s}=me(),t=j(),r=H(!1),d=B(()=>Number.parseFloat(t.market.min_amount)||1e-4),o=B(()=>Number.parseFloat(t.market.max_amount)||1e4),n=B(()=>{var k;return t.market&&t.market.min_amount&&((k=Number.parseFloat(t.market.min_amount).toString().split(".")[1])==null?void 0:k.length)||6}),l=H(d.value??0),y=H(0),_=H(0),S=B(()=>{const k=t.market.currency;return k.includes("_")?k.substring(0,k.indexOf("_")):k}),C=B(()=>{const k=t.market.pair;return k.includes("_")?k.substring(0,k.indexOf("_")):k}),A=k=>{l.value=k},w=k=>{y.value=k},Q=k=>{_.value=k},K=B(()=>e.formType+(e.orderType==="buy"?"OrderBtnBuy":"OrderBtnSell")),Y=B(()=>e.orderType==="buy"?"green":"red"),L=B(()=>e.formType=="market"?e.orderType==="buy"?t.bestAsk>0:t.bestBid>0:!0),U=B(()=>L.value?(e.orderType==="buy"?s("Buy"):s("Sell"))+" "+t.market.currency:e.orderType==="buy"?"No Asks Founds":"No Bids Found"),X=()=>{e.formType==="market"?e.orderType==="buy"?t.executeTrade("BUY","market",null,l.value):t.executeTrade("SELL","market",null,l.value):e.formType==="limit"&&(e.orderType==="buy"?t.executeTrade("BUY","limit",_.value,l.value):t.executeTrade("SELL","limit",_.value,l.value))},E=(k,M)=>{const i=e.formType==="market"?W.value:_.value,u=(e.orderType==="buy"?t.market.taker:t.market.maker)/100,c=k*(M/100)/i,b=c*u;return parseFloat(c-b).toFixed(n.value)};R(l,(k,M)=>{k!==M&&(r.value=!0)},{immediate:!1}),R(_,()=>{z()});const Z=(k,M)=>{const i=k*M/100;return e.orderType==="buy"?k+i:k-i},ee=k=>{if(t.loading)return;if(!t.market.currency&&!t.market.pair){$toast.error(`Create ${e.orderType==="buy"?t.market.pair:t.market.currency} Wallet First`);return}if(!t.bestBid&&!t.bestAsk){$toast.error("Waiting For Orderbook...");return}const M=parseFloat(t.walletCurrency),i=parseFloat(t.walletSymbol);if(_.value===0&&(_.value=W.value),e.orderType==="buy"){y.value=parseFloat(M*k/100).toFixed(n.value);const u=y.value/(1+t.market.taker/100);l.value=parseFloat(u/(e.formType==="market"?W.value:_.value)).toFixed(n.value)}else{l.value=parseFloat(i*k/100).toFixed(n.value);const u=l.value*(e.formType==="market"?W.value:_.value);y.value=parseFloat(u*(1-t.market.maker/100)).toFixed(n.value)}z()},z=()=>{if(r.value&&!t.loading&&t.walletCurrency&&t.walletSymbol){let k,M,i;if(e.orderType==="buy"?(k=t.walletCurrency,M=t.walletSymbol,i=t.market.taker):(k=t.walletSymbol,M=t.walletCurrency,i=t.market.maker),k===null){$toast.error("Create "+M+" Wallet First");return}if(e.formType==="market"&&t.bestBid===null){$toast.error("No spot price detected, Make a limit order first");return}const u=e.formType==="market"||_.value===0?W.value:_.value,c=l.value*u,b=Z(c,i);if(k<b){$toast.error("Order price higher than your wallet balance");return}y.value=b.toFixed(n.value)}},W=B(()=>t[e.orderType==="buy"?"bestAsk":"bestBid"]),te=()=>{const k=e.orderType==="buy"?t.bestAsk||t.bestBid:t.bestBid||t.bestAsk;_.value=k,z()};return ie(()=>{r.value=!1}),{ecoStore:t,submitForm:X,buttonId:K,buttonColor:Y,orderAvailability:L,buttonText:U,updateAmount:A,updateTotal:w,updatePrice:Q,calculatePercentage:ee,calculateTotalAmount:E,calculateTotal:z,minAmount:d,maxAmount:o,precisionAmount:n,amount:l,total:y,price:_,currencyName:S,pairName:C,getBestPrice:te}}};function it(e,s,t,r,d,o){const n=F("PriceInput"),l=F("AmountInput"),y=F("TotalInput"),_=F("Button");return m(),f("form",{class:"space-y-3 text-center",onSubmit:s[3]||(s[3]=$((...S)=>r.submitForm&&r.submitForm(...S),["prevent"]))},[t.formType=="limit"?(m(),N(n,{key:0,modelValue:r.price,"onUpdate:modelValue":s[0]||(s[0]=S=>r.price=S),"order-type":t.orderType,"pair-name":r.pairName,disabled:r.ecoStore.loading,"is-eco":!0,onGetBestPrice:r.getBestPrice},null,8,["modelValue","order-type","pair-name","disabled","onGetBestPrice"])):I("",!0),p(l,{modelValue:r.amount,"onUpdate:modelValue":s[1]||(s[1]=S=>r.amount=S),"order-type":t.orderType,"form-type":t.formType,"min-amount":r.minAmount,"max-amount":r.maxAmount,"precision-amount":r.precisionAmount,"currency-name":r.currencyName,disabled:r.ecoStore.loading,onCalculateTotal:r.calculateTotal,onCalculatePercentage:r.calculatePercentage},null,8,["modelValue","order-type","form-type","min-amount","max-amount","precision-amount","currency-name","disabled","onCalculateTotal","onCalculatePercentage"]),p(y,{modelValue:r.total,"onUpdate:modelValue":s[2]||(s[2]=S=>r.total=S),"taker-fee":r.ecoStore.market.taker,"maker-fee":r.ecoStore.market.maker,"order-type":t.orderType,disabled:!0,"pair-name":r.pairName},null,8,["modelValue","taker-fee","maker-fee","order-type","pair-name"]),p(_,{id:r.buttonId,color:r.buttonColor,outline:"",size:"sm",class:T(["w-full",t.formType+"Type"]),loading:r.ecoStore.loading,disabled:r.ecoStore.loading||!r.orderAvailability},{default:v(()=>[O(h(r.buttonText),1)]),_:1},8,["id","color","class","loading","disabled"])],32)}const nt=D(ot,[["render",it]]),lt={components:{Button:re,OrderForm:nt},props:{market:{type:Object,required:!0}},setup(){const e=be(),s=j();return{userStore:e,ecoStore:s,countDecimals:at}},data(){return{activeItem:"limit",loading:!1}},computed:{symbol(){return this.ecoStore.market.currency},currency(){return this.ecoStore.market.pair},symbol_chain(){return this.ecoStore.market.currency_chain},currency_chain(){return this.ecoStore.market.pair_chain}},watch:{symbol:{handler(){this.ecoStore.fetchWallets()}},currency:{handler(){this.ecoStore.fetchWallets()}}},mounted(){this.ecoStore.fetchWallets()},methods:{isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},ct={class:"Order border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},dt={class:"w-full bg-gray-200 dark:bg-gray-800"},ut={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden text-center",role:"tablist"},ht={role:"presentation"},mt=["aria-selected"],pt={role:"presentation"},yt=["aria-selected"],bt={role:"presentation"},gt=["aria-selected"],ft={id:"myTabContent",class:"px-3 py-3"},kt={class:"grid grid-cols-2 gap-5"},_t={class:"grid grid-cols-2 gap-5"},vt={class:"grid grid-cols-2 gap-5"},xt={for:"basic-url",class:"border-1 order-label peer"},wt={class:"text-dark"},St={key:1,class:"flex"},At=["value"],Ft={class:"order-span-2"},Tt={for:"basic-url",class:"border-1 order-label peer"},Bt={class:"text-dark"},Ct={key:1,class:"flex"},Ot=["value"],Mt={class:"order-span-2"};function Pt(e,s,t,r,d,o){const n=F("OrderForm"),l=F("Button");return m(),f("div",ct,[a("div",dt,[a("ul",ut,[a("li",ht,[a("button",{id:"spot-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("spot")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"spot","aria-selected":!!o.isActive("spot"),onClick:s[0]||(s[0]=y=>o.setActive("spot"))},h(e.$t("Spot")),11,mt)]),a("li",pt,[a("button",{id:"limit-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("limit")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"limit","aria-selected":!!o.isActive("limit"),onClick:s[1]||(s[1]=y=>o.setActive("limit"))},h(e.$t("Limit")),11,yt)]),a("li",bt,[a("button",{id:"wallets-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("wallets")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"wallets","aria-selected":!!o.isActive("wallets"),onClick:s[2]||(s[2]=y=>o.setActive("wallets"))},h(e.$t("Wallets")),11,gt)])])]),a("div",ft,[a("div",{id:"spot",class:T({hidden:!o.isActive("spot")}),role:"tabpanel","aria-labelledby":"spot-tab"},[a("div",kt,[p(n,{"order-type":"buy","form-type":"market"}),p(n,{"order-type":"sell","form-type":"market"})])],2),a("div",{id:"limit",class:T({hidden:!o.isActive("limit")}),role:"tabpanel","aria-labelledby":"limit-tab"},[a("div",_t,[p(n,{"order-type":"buy","form-type":"limit"}),p(n,{"order-type":"sell","form-type":"limit"})])],2),a("div",{id:"wallets",class:T({hidden:!o.isActive("wallets")}),role:"tabpanel","aria-labelledby":"wallets-tab"},[a("div",vt,[(m(),f("div",{key:"sym"+r.ecoStore.walletSymbol},[a("label",xt,[a("a",wt,h(o.symbol.includes("_")?o.symbol.substring(0,o.symbol.indexOf("_")):o.symbol)+" "+h(e.$t("Wallet")),1)]),r.ecoStore.walletSymbol==null?(m(),f("form",{key:0,onSubmit:s[3]||(s[3]=$(y=>r.ecoStore.createWallet(r.ecoStore.market.currency,r.ecoStore.market.currency_chain),["prevent"]))},[p(l,{color:"green",outline:"",size:"sm",loading:r.ecoStore.loading,disabled:r.ecoStore.loading},{default:v(()=>[O(h(e.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(m(),f("div",St,[(m(),f("input",{key:r.ecoStore.walletSymbol,type:"number",class:"order-input",value:r.ecoStore.walletSymbol,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,At)),a("span",Ft,h(r.ecoStore.market.currency),1)]))])),(m(),f("div",{key:"cur"+r.ecoStore.walletCurrency},[a("label",Tt,[a("a",Bt,h(o.currency.includes("_")?o.currency.substring(0,o.currency.indexOf("_")):o.currency)+" "+h(e.$t("Wallet")),1)]),r.ecoStore.walletCurrency==null?(m(),f("form",{key:0,onSubmit:s[4]||(s[4]=$(y=>r.ecoStore.createWallet(r.ecoStore.market.pair,r.ecoStore.market.pair_chain),["prevent"]))},[p(l,{color:"green",outline:"",size:"sm",loading:r.ecoStore.loading,disabled:r.ecoStore.loading},{default:v(()=>[O(h(e.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(m(),f("div",Ct,[(m(),f("input",{key:r.ecoStore.walletCurrency,type:"number",class:"order-input",value:r.ecoStore.walletCurrency,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,Ot)),a("span",Mt,h(r.ecoStore.market.pair),1)]))]))])],2)])])}const It=D(lt,[["render",Pt]]),Nt={components:{toDate:ve,toMoney:_e,Filter:xe,Col:we,Button:re},props:{market:{type:Object,required:!0},precisionAmount:{type:[Number,String],required:!0,default:6},precisionPrice:{type:[Number,String],required:!0,default:6}},setup(){return{ecoStore:j()}},data(){return{activeItem:"open-orders",currentPage:1,totalPages:0,currentPageOpen:1,totalPagesOpen:0,loadingCancel:!1}},computed:{currency(){return this.market.currency},pair(){return this.market.pair},openOrders(){return this.ecoStore.open_orders||[]},closedOrders(){return this.ecoStore.closed_orders||[]}},watch:{currency:{handler(){this.ecoStore.open_orders=[],this.fetchOrders()}},pair:{handler(){this.ecoStore.open_orders=[],this.fetchOrders()}}},async mounted(){await this.ecoStore.fetchOrders()},methods:{async fetchOrders(){await this.ecoStore.fetchOrders()},cancelOrder(e){this.loadingCancel=!0,axios.post("/user/eco/order/cancel",{id:e,currency:this.currency,pair:this.pair}).then(s=>{s.data?s.message.forEach(t=>{$toast[s.type](t)}):$toast[s.type](s.message),this.fetchOrders()}).catch(s=>{}).finally(()=>{this.loadingCancel=!1})},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},$t={class:"border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900",style:{margin:"0 -20px"}},Dt={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden bg-gray-200 text-center dark:bg-gray-800",role:"tablist"},Et={class:"bg-gray-100 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400"},Lt={class:"py-3 px-6","data-label":"Date"},Wt={"data-label":"TxHash",class:"text-uppercase text-center"},Ut={"data-label":"Symbol",class:"text-uppercase text-center"},zt={"data-label":"Side",class:"text-uppercase text-center"},Vt={key:0,class:"badge bg-success"},Ht={key:1,class:"badge bg-danger"},Rt={"data-label":"Price"},qt={"data-label":"Amount"},jt={"data-label":"Filled"},Kt={"data-label":"Status",class:"text-center"},Yt={class:"badge bg-primary"},Zt=["loading","disabled","onClick"],Gt={key:1,class:"badge bg-warning"},Jt={key:1},Qt={class:"text-center",colspan:"100%"},Xt=a("div",{class:"flex w-full justify-center"},[a("img",{height:"128",width:"128",src:"https://assets.staticimg.com/pro/2.0.4/images/empty.svg",alt:""})],-1),er={class:"sr-only"},tr=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1),rr={class:"sr-only"},sr=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),ar={class:"bg-gray-100 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400"},or={class:"py-3 px-6","data-label":"Date"},ir={"data-label":"TxHash",class:"text-uppercase"},nr={"data-label":"Symbol",class:"text-uppercase"},lr={"data-label":"Side",class:"text-uppercase text-center"},cr={key:0,class:"badge bg-success"},dr={key:1,class:"badge bg-danger"},ur={"data-label":"Price"},hr={"data-label":"Amount"},mr={"data-label":"Filled"},pr={"data-label":"Status"},yr={class:"badge bg-success"},br={key:1},gr={class:"text-center",colspan:"100%"},fr=a("div",{class:"flex w-full justify-center"},[a("img",{height:"128",width:"128",src:"https://assets.staticimg.com/pro/2.0.4/images/empty.svg",alt:""})],-1),kr={class:"sr-only"},_r=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1),vr={class:"sr-only"},xr=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1);function wr(e,s,t,r,d,o){const n=F("Col"),l=F("VTh"),y=F("toDate"),_=F("toMoney"),S=F("VTable"),C=F("VTPagination");return m(),f("div",$t,[a("ul",Dt,[a("li",null,[a("a",{id:"open-orders-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("open-orders")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),type:"button",role:"tab","aria-controls":"open-orders","aria-selected":"false",onClick:s[0]||(s[0]=$(A=>o.setActive("open-orders"),["prevent"]))},h(e.$t("Open Orders")),3)]),a("li",null,[a("a",{id:"closed-orders-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("closed-orders")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),type:"button",role:"tab","aria-controls":"closed-orders","aria-selected":"false",onClick:s[1]||(s[1]=$(A=>o.setActive("closed-orders"),["prevent"]))},h(e.$t("Order History")),3)])]),a("div",{id:"open-orders",class:T(["pt-3",o.isActive("open-orders")?"":"hidden"]),role:"tabpanel",style:{"min-height":"300px"}},[p(S,{"current-page":d.currentPageOpen,"onUpdate:currentPage":s[2]||(s[2]=A=>d.currentPageOpen=A),class:"w-full text-left text-sm text-gray-500 dark:text-gray-400",data:o.openOrders,"page-size":10,"hide-sort-icons":!0,onTotalPagesChanged:s[3]||(s[3]=A=>d.totalPagesOpen=A)},{head:v(()=>[a("tr",Et,[p(l,{"sort-key":"created",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Date"})]),_:1}),p(l,{"sort-key":"order_id",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"TxHash"})]),_:1}),p(l,{"sort-key":"symbol",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Symbol"})]),_:1}),p(l,{"sort-key":"side",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Side"})]),_:1}),p(l,{"sort-key":"price",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Price"})]),_:1}),p(l,{"sort-key":"amount",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Amount"})]),_:1}),p(l,{"sort-key":"filled",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Filled"})]),_:1}),p(l,{"sort-key":"status",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Status"})]),_:1})])]),body:v(({rows:A})=>[o.openOrders&&o.openOrders.length>0?(m(!0),f(q,{key:0},J(A,w=>(m(),f("tr",{key:w.id,class:"border-b bg-white dark:border-gray-700 dark:bg-gray-800"},[a("td",Lt,[p(y,{time:w.created},null,8,["time"])]),a("td",Wt,h(w.id),1),a("td",Ut,h(w.pair),1),a("td",zt,[w.type=="BUY"?(m(),f("span",Vt,h(e.$t("Buy")),1)):(m(),f("span",Ht,h(e.$t("Sell")),1))]),a("td",Rt,[p(_,{num:w.price,decimals:t.precisionPrice},null,8,["num","decimals"]),O(" "+h(o.pair),1)]),a("td",qt,[p(_,{num:w.amount,decimals:t.precisionAmount},null,8,["num","decimals"]),O(" "+h(o.currency),1)]),a("td",jt,[p(_,{num:w.fill,decimals:t.precisionAmount},null,8,["num","decimals"]),O(" "+h(o.currency),1)]),a("td",Kt,[w.fill==0?(m(),f(q,{key:0},[a("span",Yt,h(e.$t("Pending")),1),a("button",{class:"btn btn-sm btn-danger",loading:d.loadingCancel,disabled:d.loadingCancel,type:"button",onClick:Q=>o.cancelOrder(w.id)},h(e.$t("Cancel")),9,Zt)],64)):w.fill>0&&w.fill!=w.amount?(m(),f("span",Gt,h(e.$t("Filling")),1)):I("",!0)])]))),128)):(m(),f("tr",Jt,[a("td",Qt,[Xt,O(" "+h(e.$t("No Data Found")),1)])]))]),_:1},8,["current-page","data"]),p(C,{currentPage:d.currentPageOpen,"onUpdate:currentPage":s[4]||(s[4]=A=>d.currentPageOpen=A),class:"flex items-center justify-between p-3","aria-label":"Table navigation","total-pages":d.totalPagesOpen,"max-page-links":3,"boundary-links":!0},{firstPage:v(()=>[O(h(e.$t("First")),1)]),lastPage:v(()=>[O(h(e.$t("Last")),1)]),next:v(()=>[a("span",er,h(e.$t("Next")),1),tr]),previous:v(()=>[a("span",rr,h(e.$t("Previous")),1),sr]),_:1},8,["currentPage","total-pages"])],2),a("div",{id:"closed-orders",class:T(["pt-3",o.isActive("closed-orders")?"":"hidden"]),role:"tabpanel",style:{"min-height":"300px"}},[p(S,{"current-page":d.currentPage,"onUpdate:currentPage":s[5]||(s[5]=A=>d.currentPage=A),class:"w-full text-left text-sm text-gray-500 dark:text-gray-400",data:o.closedOrders,"page-size":10,"hide-sort-icons":!0,onTotalPagesChanged:s[6]||(s[6]=A=>d.totalPages=A)},{head:v(()=>[a("tr",ar,[p(l,{"sort-key":"created",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Date"})]),_:1}),p(l,{"sort-key":"order_id",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"TxHash"})]),_:1}),p(l,{"sort-key":"symbol",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Symbol"})]),_:1}),p(l,{"sort-key":"side",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Side"})]),_:1}),p(l,{"sort-key":"price",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Price"})]),_:1}),p(l,{"sort-key":"amount",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Amount"})]),_:1}),p(l,{"sort-key":"filled",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Filled"})]),_:1}),p(l,{"sort-key":"status",scope:"col",class:"py-3 px-6"},{default:v(()=>[p(n,{text:"Status"})]),_:1})])]),body:v(({rows:A})=>[o.closedOrders&&o.closedOrders.length>0?(m(!0),f(q,{key:0},J(A,w=>(m(),f("tr",{key:w.id,class:"border-b bg-white dark:border-gray-700 dark:bg-gray-800"},[a("td",or,[p(y,{time:w.created},null,8,["time"])]),a("td",ir,h(w.id),1),a("td",nr,h(w.pair),1),a("td",lr,[w.type=="BUY"?(m(),f("span",cr,h(e.$t("Buy")),1)):(m(),f("span",dr,h(e.$t("Sell")),1))]),a("td",ur,[p(_,{num:w.price,decimals:t.precisionPrice},null,8,["num","decimals"]),O(" "+h(o.pair),1)]),a("td",hr,[p(_,{num:w.amount,decimals:t.precisionAmount},null,8,["num","decimals"]),O(" "+h(o.currency),1)]),a("td",mr,[p(_,{num:w.fill,decimals:t.precisionAmount},null,8,["num","decimals"]),O(" "+h(o.currency),1)]),a("td",pr,[a("span",yr,h(e.$t("Filled")),1)])]))),128)):(m(),f("tr",br,[a("td",gr,[fr,O(" "+h(e.$t("No Data Found")),1)])]))]),_:1},8,["current-page","data"]),p(C,{currentPage:d.currentPage,"onUpdate:currentPage":s[7]||(s[7]=A=>d.currentPage=A),class:"flex items-center justify-between p-3","aria-label":"Table navigation","total-pages":d.totalPages,"max-page-links":3,"boundary-links":!0},{firstPage:v(()=>[O(h(e.$t("First")),1)]),lastPage:v(()=>[O(h(e.$t("Last")),1)]),next:v(()=>[a("span",kr,h(e.$t("Next")),1),_r]),previous:v(()=>[a("span",vr,h(e.$t("Previous")),1),xr]),_:1},8,["currentPage","total-pages"])],2)])}const Sr=D(Nt,[["render",wr]]),Ar={name:"NewSvg",props:{path1:{type:String,required:!0},path2:{type:String,required:!1},path3:{type:String,required:!0},fill1:{type:String,required:!0},fill2:{type:String,required:!0}}},Fr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Tr=["d","fill"],Br=["d","fill"],Cr=["d"];function Or(e,s,t,r,d,o){return m(),f("svg",Fr,[a("path",{d:t.path1,fill:t.fill1},null,8,Tr),a("path",{d:t.path2,fill:t.fill2},null,8,Br),a("path",{d:t.path3,fill:"currentColor"},null,8,Cr)])}const Mr=D(Ar,[["render",Or]]),Pr={components:{ListItem:Se,NewSvg:Mr},props:{market:{type:Object,required:!0}},setup(e){const s=j(),t=pe({limit:{asks:12,bids:12},showMoreAsks:!1,showMoreBids:!1,sideLength:20,refreshRate:500,bestAsker:0,bestAskerIcon:null,bestAskerClass:null,lastUpdated:"",activeItem:"pills-graph",data:{},asks:Array.from({length:20},()=>[0,0,0,0]),bids:Array.from({length:20},()=>[0,0,0,0])}),r=B(()=>e.market.currency),d=B(()=>e.market.pair),o=H(null),n=H([]),l={sort(i){return i.sort((u,c)=>u[1]-c[1])},median(i){const u=Math.floor(i.length/3*2);return i[u][1]<1?1:i[u][1]},medianUnit(i,u,c){const b=[...i,...u];return this.median(this.sort(b))/c},width(i,u){if(u===0)return 1;const c=Math.round(Number(i)/u);return c<=0?1:Math.min(160,c)}};function y(i,u){const c=l.medianUnit(i,u,48);i.forEach(b=>{b.push({width:l.width(b[1],c)*2.5})}),u.forEach(b=>{b.push({width:l.width(b[1],c)*2.5})})}function _(){const i=[...t.asks,...t.bids],u=l.medianUnit(t.asks,t.bids,48);i.forEach(c=>{c[1]>0&&(c[2].width=l.width(c[1],u)*2.5)})}const S={width:250,sortwidth:l,init:y};R(()=>t.asks,()=>{_()},{deep:!0}),R(()=>t.bids,()=>{_()},{deep:!0}),R(r,async()=>{n.value=[],t.bestAskerClass=null,t.bestAskerIcon=null,s.bestAsk=0,s.bestBid=0,t.bestBidder=0,t.bestAsker=0,t.asks=Array.from({length:20},()=>[0,0,0,0]),t.bids=Array.from({length:20},()=>[0,0,0,0]),await K(r.value,d.value),Z(),await Y(r.value,d.value)}),R(d,async()=>{n.value=[],t.bestAskerClass=null,t.bestAskerIcon=null,s.bestAsk=0,s.bestBid=0,t.bestBidder=0,t.bestAsker=0,t.asks=Array.from({length:20},()=>[0,0,0,0]),t.bids=Array.from({length:20},()=>[0,0,0,0]),await K(r.value,d.value),Z(),await Y(r.value,d.value)});function C(i){return activeItem===i}function A(i){activeItem=i}const w=B(()=>{const i=t.asks.slice().sort((c,b)=>{const g=parseFloat(c[0]),x=parseFloat(b[0]);return g===0&&x===0?0:g===0?-1:x===0?1:x-g});return(t.showMoreAsks?i:i.slice(-t.limit.asks)).map(([c,b,{width:g}])=>[E(c,X.value),E(b,U.value),E(c*b,U.value),g])}),Q=B(()=>t.bids.map(([i,u,{width:c}])=>[E(i,X.value),E(u,U.value),E(i*u,U.value),c]));async function K(i,u){try{const c=await axios.post("/user/eco/orderbook",{currency:i,pair:u});c.length>0&&L(c)}catch(c){$toast.error(c.message)}}async function Y(i,u){try{const b=(await axios.post("/user/eco/orderbook/history",{currency:i,pair:u})).filter(g=>!n.value.find(x=>x.id===g.id));b.length>0&&L(b),s.marketOrder=t.asks.length>0}catch{}}async function L(i){i.forEach(c=>W(c)),i=te(n.value);const u=Date.now();if(!t.lastUpdated||u-t.lastUpdated>t.refreshRate){S.init(i.bids,i.asks),i.asks.sort((x,P)=>x[0]-P[0]),i.bids.sort((x,P)=>P[0]-x[0]);const c=i.asks[0]?i.asks[0][0]:null,b=i.bids[0]?i.bids[0][0]:null,g=c&&c>t.bestAsker;t.bestAskerClass=g?"text-success":"text-danger",t.bestAskerIcon=g?"bi-arrow-up text-success":"bi-arrow-down text-danger",t.bestAsker=Number(c),s.bestAsk=Number(c),s.bestBid=Number(b),t.lastUpdated=u,k(t.asks,i.asks,t.sideLength),k(t.bids,i.bids,t.sideLength)}else await new Promise(c=>requestAnimationFrame(c)),await new Promise(c=>setTimeout(c,t.refreshRate/2))}const U=B(()=>{if(t.asks.length===0&&t.bids.length===0)return 6;const c=[...t.asks.map(b=>Number(b[1])),...t.bids.map(b=>Number(b[1]))].filter(b=>b!==0).reduce((b,g)=>{const x=(g.toString().split(".")[1]||"").length;return Math.max(b,x)},0);return s.precisionAmount=c,c}),X=B(()=>{if(t.asks.length===0&&t.bids.length===0)return 8;const c=[...t.asks.map(b=>Number(b[0])),...t.bids.map(b=>Number(b[0]))].filter(b=>b!==0).reduce((b,g)=>{const x=(g.toString().split(".")[1]||"").length;return Math.max(b,x)},0);return s.precisionPrice=c,c});function E(i,u=8,c=","){return isNaN(i)?"0":(u=parseInt(u),i=Number(i).toFixed(u),i)}function Z(){M();const i=`orderbook-data.${r.value}.${d.value}`;o.value=window.Echo.private(i),o.value.listen(".orderbook-deleted",async u=>{ee(u.order)}),o.value.listen(".orderbook",async u=>{z(u.orderbook)})}function ee(i){n.value=n.value.filter(u=>u.id!==i),["asks","bids"].forEach(u=>{const c=t[u].findIndex(([b,,,g])=>g===i);c!==-1&&t[u].splice(c,1)}),L(n.value)}function z(i){const u=i.type==="BUY"?"SELL":"BUY";n.value=n.value.filter(g=>g.amount-g.fill>0);const c=n.value.filter(g=>g.type===u).sort((g,x)=>g.price-x.price),b=c.findIndex(g=>Math.abs(g.price-i.price)<1e-8);if(b!==-1){const g=c[b],x=Number(i.amount)-Number(i.fill),P=Number(g.amount)-Number(g.fill);if(x>=P){i.fill+=P;const G=n.value.indexOf(g);G!==-1&&n.value.splice(G,1);const V=u==="BUY"?"bids":"asks",se=t[V].findIndex(ae=>Math.abs(ae[0]-g.price)<1e-8);se!==-1&&(t[V]=JSON.parse(JSON.stringify(t[V].filter((ae,ne)=>ne!==se))))}else g.fill+=x,i.fill=i.amount}i.fill<i.amount&&n.value.push(i),L(n.value)}function W(i){const u=n.value.findIndex(c=>c.id===i.id);u!==-1?n.value[u]=i:n.value.push(i)}function te(i){let u={},c={};Array.isArray(i)||(i=[i]),i.forEach(g=>{if(g.price){let x=Number(g.price).toFixed(8),P=g.type==="BUY"?u:c;P[x]?P[x][1]=(Number(P[x][1])+Number(g.amount)).toFixed(8):P[x]=[x,Number(g.amount-g.fill).toFixed(8)]}});const b=(g,x)=>{let P=Object.values(g);return P.sort((G,V)=>{if(x==="PRICE_ASC")return parseFloat(G[0])>parseFloat(V[0])?1:-1;if(x==="PRICE_DESC")return parseFloat(G[0])<parseFloat(V[0])?1:-1}),P};return{bids:b(u,"PRICE_DESC"),asks:b(c,"PRICE_ASC")}}function k(i,u,c){u.forEach(b=>{const g=i.findIndex(x=>x[0]===b[0]);g>=0?i.splice(g,1,b):i.push(b)}),i.sort((b,g)=>g[0]-b[0]),i.splice(c)}ie(()=>{K(r.value,d.value),Z(),Y(r.value,d.value)});function M(){o.value&&(window.Echo.leave(`orderbook-data.${r.value}.${d.value}`),o.value=null)}return ye(()=>{M()}),{ecoStore:s,state:t,currency:r,pair:d,formattedAsks:w,formattedBids:Q,isActive:C,setActive:A}}},Ir={class:"Orderbook border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},Nr={class:"flex p-1 xs:hidden md:flex",role:"tablist"},$r={class:"p-1"},Dr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Er=a("path",{d:"M4 4h7v7H4V4z",fill:"#F6465D"},null,-1),Lr=a("path",{d:"M4 13h7v7H4v-7z",fill:"#0ECB81"},null,-1),Wr=a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1),Ur=[Er,Lr,Wr],zr={class:"p-1"},Vr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Hr=a("path",{d:"M4 4h7v16H4V4z",fill:"#0ECB81"},null,-1),Rr=a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1),qr=[Hr,Rr],jr={class:"p-1"},Kr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Yr=a("path",{d:"M4 4h7v16H4V4z",fill:"#F6465D"},null,-1),Zr=a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1),Gr=[Yr,Zr],Jr={key:0,class:"Asks"},Qr={style:{"overflow-x":"hidden"}},Xr={class:""},es={class:"text-start",style:{"padding-left":"5px"},scope:"col"},ts=a("th",{class:"text-center if-sm",scope:"col"},"Amount",-1),rs={class:"text-end",style:{"padding-right":"5px"},scope:"col"},ss={class:"LastPrice xs:hidden md:block"},as={class:"p-3"},os=a("span",{class:""},"Last Price: ",-1),is={key:1,class:"Bids"},ns={style:{"overflow-x":"hidden"}},ls={key:0,class:""},cs={class:"pl-2 text-start",scope:"col"},ds={class:"text-center if-sm",scope:"col"},us={class:"text-end",scope:"col"},hs={key:1,class:"xs:flex md:hidden"},ms={class:"pl-2 text-start",scope:"col"},ps={class:"text-center if-sm",scope:"col"},ys={class:"text-end",scope:"col"};function bs(e,s,t,r,d,o){const n=F("ListItem");return m(),f("div",Ir,[a("ul",Nr,[a("li",$r,[a("button",{class:T({"text-gray-200 dark:text-gray-600":r.state.showMoreAsks||r.state.showMoreBids||r.state.showMoreAsks&&r.state.showMoreBids}),onClick:s[0]||(s[0]=$(l=>(r.state.showMoreAsks=!1,r.state.showMoreBids=!1,r.state.limit.asks=12,r.state.limit.bids=12),["prevent"]))},[(m(),f("svg",Dr,Ur))],2)]),a("li",zr,[a("button",{class:T({"text-gray-200 dark:text-gray-600":!r.state.showMoreBids||r.state.showMoreAsks}),onClick:s[1]||(s[1]=$(l=>(r.state.showMoreAsks=!1,r.state.showMoreBids=!0,r.state.limit.asks=0,r.state.limit.bids=20),["prevent"]))},[(m(),f("svg",Vr,qr))],2)]),a("li",jr,[a("button",{class:T({"text-gray-200 dark:text-gray-600":r.state.showMoreBids||!r.state.showMoreAsks}),onClick:s[2]||(s[2]=$(l=>(r.state.showMoreAsks=!0,r.state.showMoreBids=!1,r.state.limit.asks=20,r.state.limit.bids=0),["prevent"]))},[(m(),f("svg",Kr,Gr))],2)])]),(m(),f("div",{key:r.state.limit.asks,class:"OrderbookGrid"},[r.state.limit.asks!=0?(m(),f("div",Jr,[a("table",Qr,[a("thead",Xr,[a("th",es,h(e.$t("Price")),1),ts,a("th",rs,h(e.$t("Total")),1)]),a("tbody",null,[(m(),N(n,{key:r.state.showMoreBids,data:r.formattedAsks,type:"ask","show-less":r.state.showMoreBids,limit:r.state.limit.asks},null,8,["data","show-less","limit"]))])])])):I("",!0),a("div",ss,[a("div",as,[os,a("span",{class:T(r.state.bestAskerClass)},h(r.state.bestAsker??0),3),a("i",{class:T(["bi",r.state.bestAskerIcon])},null,2)])]),r.state.limit.bids!=0?(m(),f("div",is,[a("table",ns,[r.state.limit.asks==0?(m(),f("thead",ls,[a("th",cs,h(e.$t("Price")),1),a("th",ds,h(e.$t("Amount")),1),a("th",us,h(e.$t("Total")),1)])):I("",!0),r.state.limit.asks!=0?(m(),f("thead",hs,[a("th",ms,h(e.$t("Price")),1),a("th",ps,h(e.$t("Amount")),1),a("th",ys,h(e.$t("Total")),1)])):I("",!0),a("tbody",null,[(m(),N(n,{key:r.state.showMoreAsks,data:r.formattedBids,type:"bid","show-less":r.state.showMoreAsks,limit:r.state.limit.bids},null,8,["data","show-less","limit"]))])])])):I("",!0)]))])}const gs=D(Pr,[["render",bs]]);const fs={components:{Markets:ce,EcoMarkets:Le,Trades:et,Charting:st,Order:It,Orders:Sr,Orderbook:gs},setup(){return{ecoStore:j()}},data(){return{symbol:this.$route.params.symbol,currency:this.$route.params.currency,index:0,plat,ext}},watch:{async $route(e,s){this.fetchData()}},created(){this.fetchData()},methods:{getRandomInt(e,s){return e=Math.ceil(e),s=Math.floor(s),Math.floor(Math.random()*(s-e))+e},async fetchData(){await this.ecoStore.fetch(this.$route.params.symbol,this.$route.params.currency)},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},ks={class:"EcoContainer",style:{margin:"-18px -20px 3px -20px"}},_s={id:"creatable",class:"Chart border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"};function vs(e,s,t,r,d,o){const n=F("EcoMarkets"),l=F("Markets"),y=F("Trades"),_=F("Charting"),S=F("Order"),C=F("Orderbook"),A=F("Orders");return m(),f("div",null,[a("div",ks,[d.ext.eco==1&&d.plat.eco.ecosystem_trading_only==1?(m(),N(n,{key:0,style:{"overflow-y":"auto","overflow-x":"hidden"},type:"trade",subtype:"non"})):(m(),N(l,{key:1,style:{"overflow-y":"auto","overflow-x":"hidden"},type:"trade",subtype:"non"})),r.ecoStore.market.length!=0?(m(),N(y,{key:2,market:r.ecoStore.market,"precision-amount":r.ecoStore.precisionAmount,"precision-price":r.ecoStore.precisionPrice},null,8,["market","precision-amount","precision-price"])):I("",!0),a("div",_s,[r.ecoStore.market.length!=0?(m(),N(_,{key:r.ecoStore.market.currency+r.ecoStore.market.pair,market:r.ecoStore.market},null,8,["market"])):I("",!0)]),r.ecoStore.market.length!=0?(m(),N(S,{key:3,market:r.ecoStore.market},null,8,["market"])):I("",!0),r.ecoStore.market.length!=0?(m(),N(C,{key:4,market:r.ecoStore.market},null,8,["market"])):I("",!0)]),r.ecoStore.market.length!=0?(m(),N(A,{key:0,market:r.ecoStore.market,"precision-amount":r.ecoStore.precisionAmount,"precision-price":r.ecoStore.precisionPrice},null,8,["market","precision-amount","precision-price"])):I("",!0)])}const Ws=D(fs,[["render",vs]]);export{Ws as default};
