import{_ as z,bT as Y,k as _,l as b,x as M,y as Z,r as P,o as c,c as d,e as x,f as A,i as C,w as N,g as W,t as u,n as T,q as V,X as $,a as i}from"./bootstrap-26bee35b.js";import{C as U}from"./flowbite-vue-a1a41228.js";import{u as ee}from"./market-8ae68380.js";import{u as E}from"./user-7d9b5f4d.js";import{A as te,T as re,P as ae}from"./PriceInput-32e20367.js";import"./_commonjsHelpers-de833af9.js";import"./browser-77dd377d.js";import"./preload-helper-f61836a9.js";import"./axios-4a70c6fc.js";const oe={components:{Button:U,AmountInput:te,TotalInput:re,PriceInput:ae},props:{orderType:String,formType:String,currency:String,pair:String,pfee:[Number,String],fee:[Number,String],store:Object,auth:{type:Boolean,default:!0}},emits:["OrderPlaced"],setup(t,{emit:a}){const{t:r}=Y(),e=_(!1),B=E(),k=b(()=>Number.parseFloat(t.store.market.limits.amount.min)||1e-4),f=b(()=>(provider==="kucoin"?Number.parseFloat(t.store.market.precision.price):1e-8)||1e-4),g=b(()=>Number.parseFloat(t.store.market.limits.amount.max)||1e4),n=b(()=>{if(t.store.market&&t.store.market.precision.amount){const o=Number.parseFloat(t.store.market.precision.amount);if(Number.isInteger(o))return o;{const s=o.toString().match(/(\d+(\.\d+)?)[eE][+-]\d+/);if(s){const y=(parseFloat(s[1]).toString().split(".")[1]||"").length,v=parseInt(s[0].split(/e|E/)[1]);return y+Math.abs(v)}else return o.toString().split(".")[1].length}}return 6}),S=b(()=>{if(t.store.market&&t.store.market.limits.cost.min)return Number.parseFloat(t.store.market.limits.cost.min)}),l=_(k.value??0),h=_(0),m=_(0),L=o=>{l.value=o},G=o=>{h.value=o},j=o=>{m.value=o},q=b(()=>t.formType+(t.orderType==="buy"?"OrderBtnBuy":"OrderBtnSell")),D=b(()=>t.orderType==="buy"?"green":"red"),p=b(()=>t.formType=="market"?t.orderType==="buy"?t.store.bestAsk>0:t.store.bestBid>0:!0),R=b(()=>p.value?(t.orderType==="buy"?r("Buy"):r("Sell"))+" "+t.currency:(t.orderType==="buy","Loading Orderbook...")),X=async()=>{if(S.value&&h.value<S.value){$toast.error(r(`The minimum order size is ${S.value} ${t.pair}`));return}try{await t.store.executeTrade(t.orderType,t.formType,t.formType==="market"?null:m.value,l.value,t.currency,t.pair),a("OrderPlaced")}catch(o){$toast.error("Error executing trade:",o)}},H=(o,s)=>{const y=t.formType==="market"?F.value:m.value,v=t.pfee/100,w=o*(s/100)/y,I=w*v;return parseFloat(w-I).toFixed(n.value)};M(l,(o,s)=>{o!==s&&(e.value=!0)},{immediate:!1}),M(m,()=>{O()});const J=(o,s)=>{const y=o*s/100;return t.orderType==="buy"?o+y:o-y},K=o=>{if(!t.currency&&!t.pair){$toast.error(`Create ${t.orderType==="buy"?t.pair:t.currency} Wallet First`);return}if(!t.store.bestBid&&!t.store.bestAsk){$toast.error("Waiting For Orderbook...");return}const s=parseFloat(t.store.currencyBalance),y=parseFloat(t.store.pairBalance);if(m.value===0&&(m.value=F.value),t.orderType==="buy"){h.value=parseFloat(y*o/100).toFixed(n.value);const v=h.value/(1+t.pfee/100);l.value=parseFloat(v/(t.formType==="market"?F.value:m.value)).toFixed(n.value)}else{l.value=parseFloat(s*o/100).toFixed(n.value);const v=l.value*(t.formType==="market"?F.value:m.value);h.value=parseFloat(v*(1-t.pfee/100)).toFixed(n.value)}O()},O=()=>{if(e.value){let o,s,y;if(t.orderType==="buy"?(o=t.store.pairBalance,s=t.pair):(o=t.store.currencyBalance,s=t.currency),y=t.pfee,t.formType==="market"&&t.store.bestBid===null){$toast.error("No spot price detected, Make a limit order first");return}const v=t.formType==="market"||m.value===0?F.value:m.value,w=l.value*v,I=J(w,y);if((t.orderType==="buy"?o:w)<I){$toast.error(`Order amount higher than your ${s} wallet balance with fees`);return}h.value=I.toFixed(n.value)}},F=b(()=>t.store[t.orderType==="buy"?"bestAsk":"bestBid"]),Q=()=>{const o=t.orderType==="buy"?t.store.bestAsk||t.store.bestBid:t.store.bestBid||t.store.bestAsk;m.value=o,O()};return Z(()=>{e.value=!1}),{submitForm:X,buttonId:q,buttonColor:D,orderAvailability:p,buttonText:R,updateAmount:L,updateTotal:G,updatePrice:j,calculatePercentage:K,calculateTotalAmount:H,calculateTotal:O,minAmount:k,minPrice:f,maxAmount:g,precisionAmount:n,amount:l,total:h,price:m,getBestPrice:Q,userStore:B}}},le={key:2,href:"/app"};function ne(t,a,r,e,B,k){const f=P("PriceInput"),g=P("AmountInput"),n=P("TotalInput"),S=P("Button");return c(),d("form",{class:"space-y-5 text-center",onSubmit:a[3]||(a[3]=V((...l)=>e.submitForm&&e.submitForm(...l),["prevent"]))},[r.formType=="limit"?(c(),x(f,{key:0,modelValue:e.price,"onUpdate:modelValue":a[0]||(a[0]=l=>e.price=l),"order-type":r.orderType,"min-price":e.minPrice,"pair-name":r.pair,onGetBestPrice:e.getBestPrice},null,8,["modelValue","order-type","min-price","pair-name","onGetBestPrice"])):A("",!0),C(g,{modelValue:e.amount,"onUpdate:modelValue":[a[1]||(a[1]=l=>e.amount=l),e.calculateTotal],"order-type":r.orderType,"form-type":r.formType,"min-amount":e.minAmount,"max-amount":e.maxAmount,"precision-amount":e.precisionAmount,"currency-name":r.currency,onCalculateTotal:e.calculateTotal,onCalculatePercentage:e.calculatePercentage},null,8,["modelValue","order-type","form-type","min-amount","max-amount","precision-amount","currency-name","onCalculateTotal","onCalculatePercentage","onUpdate:modelValue"]),C(n,{modelValue:e.total,"onUpdate:modelValue":a[2]||(a[2]=l=>e.total=l),"taker-fee":r.pfee,"maker-fee":r.pfee,"order-type":r.orderType,disabled:!0,"pair-name":r.pair},null,8,["modelValue","taker-fee","maker-fee","order-type","pair-name"]),e.userStore.user?(c(),x(S,{key:1,id:e.buttonId,color:e.buttonColor,outline:"",size:"sm",class:T(["w-full",r.formType+"Type"]),loading:r.store.loading,disabled:r.store.loading||!e.orderAvailability},{default:N(()=>[W(u(e.buttonText),1)]),_:1},8,["id","color","class","loading","disabled"])):(c(),d("a",le,[C(S,{id:e.buttonId,color:e.buttonColor,outline:"",size:"sm",class:T(["w-full mt-5",r.formType+"Type"]),loading:r.store.loading,disabled:r.store.loading||!e.orderAvailability,type:"button"},{default:N(()=>[W(u(t.$t("Login To Trade")),1)]),_:1},8,["id","color","class","loading","disabled"])]))],32)}const ie=z(oe,[["render",ne]]);const ce={components:{OrderForm:ie,Button:U},props:{fee:{type:[Number,String],default:0},pfee:{type:[Number,String],default:0},auth:{type:Boolean,default:!0}},emits:["OrderPlaced"],setup(){const t=E(),a=ee(),r=$(),e=_(r.params.symbol),B=_(r.params.currency);a.fetchWallet(e.value,1),a.fetchWallet(B.value,2);const k=_("spot"),f=_(!1),g=window.provider;return{marketStore:a,userStore:t,currency:e,pair:B,activeItem:k,loading:f,provider:g,isActive:l=>k.value===l,setActive:l=>{k.value=l}}}},se={class:"Order border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},de={class:"w-full bg-gray-200 dark:bg-gray-800"},ue={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden text-center",role:"tablist"},me={role:"presentation"},ye=["aria-selected"],fe={role:"presentation"},be=["aria-selected"],ve={key:0,role:"presentation"},ke=["aria-selected"],ge={id:"myTabContent",class:"px-3 py-3"},Te={class:"grid grid-cols-2 gap-5"},_e={class:"grid grid-cols-2 gap-5"},Se={class:"grid grid-cols-2 gap-5"},he={for:"basic-url",class:"border-1 order-label peer"},Ae={class:"text-dark"},Be={key:1,class:"flex"},Pe=["value"],xe={class:"order-span-2"},Fe={for:"basic-url",class:"border-1 order-label peer"},we={class:"text-dark"},Ce={key:1,class:"flex"},Oe=["value"],Ie={class:"order-span-2"};function Ne(t,a,r,e,B,k){const f=P("order-form"),g=P("Button");return c(),d("div",se,[i("div",de,[i("ul",ue,[i("li",me,[i("button",{id:"spot-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",e.isActive("spot")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"spot","aria-selected":!!e.isActive("spot"),onClick:a[0]||(a[0]=n=>e.setActive("spot"))},u(t.$t("Spot")),11,ye)]),i("li",fe,[i("button",{id:"limit-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",e.isActive("limit")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"limit","aria-selected":!!e.isActive("limit"),onClick:a[1]||(a[1]=n=>e.setActive("limit"))},u(t.$t("Limit")),11,be)]),r.auth?(c(),d("li",ve,[i("button",{id:"wallets-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",e.isActive("wallets")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"wallets","aria-selected":!!e.isActive("wallets"),onClick:a[2]||(a[2]=n=>e.setActive("wallets"))},u(t.$t("Wallets")),11,ke)])):A("",!0)])]),i("div",ge,[i("div",{id:"spot",class:T({hidden:!e.isActive("spot")}),role:"tabpanel","aria-labelledby":"spot-tab"},[i("div",Te,[e.marketStore.market!=null?(c(),x(f,{key:0,"order-type":"buy","form-type":"market",fee:r.fee,pfee:r.pfee,store:e.marketStore,currency:e.currency,pair:e.pair,auth:r.auth,onOrderPlaced:a[3]||(a[3]=n=>t.$emit("OrderPlaced"))},null,8,["fee","pfee","store","currency","pair","auth"])):A("",!0),e.marketStore.market!=null?(c(),x(f,{key:1,"order-type":"sell","form-type":"market",fee:r.fee,pfee:r.pfee,store:e.marketStore,currency:e.currency,pair:e.pair,auth:r.auth,onOrderPlaced:a[4]||(a[4]=n=>t.$emit("OrderPlaced"))},null,8,["fee","pfee","store","currency","pair","auth"])):A("",!0)])],2),i("div",{id:"limit",class:T({hidden:!e.isActive("limit")}),role:"tabpanel","aria-labelledby":"limit-tab"},[i("div",_e,[e.marketStore.market!=null?(c(),x(f,{key:0,"order-type":"buy","form-type":"limit",fee:r.fee,pfee:r.pfee,store:e.marketStore,currency:e.currency,pair:e.pair,auth:r.auth,onOrderPlaced:a[5]||(a[5]=n=>t.$emit("OrderPlaced"))},null,8,["fee","pfee","store","currency","pair","auth"])):A("",!0),e.marketStore.market!=null?(c(),x(f,{key:1,"order-type":"sell","form-type":"limit",fee:r.fee,pfee:r.pfee,store:e.marketStore,currency:e.currency,pair:e.pair,auth:r.auth,onOrderPlaced:a[6]||(a[6]=n=>t.$emit("OrderPlaced"))},null,8,["fee","pfee","store","currency","pair","auth"])):A("",!0)])],2),r.auth?(c(),d("div",{key:0,id:"wallets",class:T({hidden:!e.isActive("wallets")}),role:"tabpanel","aria-labelledby":"wallets-tab"},[i("div",Se,[(c(),d("div",{key:"sym"+e.marketStore.currencyBalance},[i("label",he,[i("a",Ae,u(e.currency)+" "+u(t.$t("Wallet")),1)]),e.marketStore.currencyBalance==null?(c(),d("form",{key:0,onSubmit:a[7]||(a[7]=V(n=>e.marketStore.createWallet(e.currency,1),["prevent"]))},[C(g,{color:"green",outline:"",size:"sm",loading:e.marketStore.loading,disabled:e.marketStore.loading},{default:N(()=>[W(u(t.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(c(),d("div",Be,[(c(),d("input",{key:e.marketStore.currencyBalance,type:"number",class:"order-input",value:e.marketStore.currencyBalance,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,Pe)),i("span",xe,u(e.currency),1)]))])),(c(),d("div",{key:"cur"+e.marketStore.pairBalance},[i("label",Fe,[i("a",we,u(e.pair)+" "+u(t.$t("Wallet")),1)]),e.marketStore.pairBalance==null?(c(),d("form",{key:0,onSubmit:a[8]||(a[8]=V(n=>e.marketStore.createWallet(e.pair,2),["prevent"]))},[C(g,{color:"green",outline:"",size:"sm",loading:e.marketStore.loading,disabled:e.marketStore.loading},{default:N(()=>[W(u(t.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(c(),d("div",Ce,[(c(),d("input",{key:e.marketStore.pairBalance,type:"number",class:"order-input",value:e.marketStore.pairBalance,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,Oe)),i("span",Ie,u(e.pair),1)]))]))])],2)):A("",!0)])])}const je=z(ce,[["render",Ne],["__scopeId","data-v-8f71af4b"]]);export{je as default};
