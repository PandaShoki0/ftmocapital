import{a as le,M as ce}from"./Markets-264389a6.js";import{u as de}from"./market-8356724b.js";import{_ as E,r as F,o as h,c as f,a,q as D,n as T,F as q,b as J,t as m,e as N,f as I,d as ue,Q as me,c6 as he,k as H,l as B,u as R,x as ie,i as p,w as _,g as O,G as pe,bp as ye}from"./bootstrap-249b0f62.js";import{d as oe}from"./datafeed-d62ae98f.js";import{C as re}from"./flowbite-vue-7e69f603.js";import{u as be}from"./user-5d70a0d6.js";import{A as ge,T as fe,P as ke}from"./PriceInput-714ad0f0.js";import{t as ve}from"./toMoney-88a56e62.js";import{t as _e}from"./toDate-734c7690.js";import{F as xe}from"./Filter-3bb21f90.js";import{C as we}from"./Col-3a6cbfed.js";import{L as Se}from"./ListItem-a6b6e883.js";/* empty css                                                                       */import"./_commonjsHelpers-de833af9.js";import"./dijkstra-f906a09e.js";import"./preload-helper-f61836a9.js";import"./axios-7a713374.js";const Ae={components:{MarketList:le},props:["type","subtype"],setup(){return{marketStore:de()}},data(){return{old:[],markets:[],ext,activeItem:"fav"}},created(){this.fetchMarkets(),this.fetchFavs()},mounted(){},methods:{fetchMarkets(){axios.get("/user/eco/markets").then(e=>{this.markets=e.markets})},async fetchFavs(){this.marketStore.favs.length==0&&await this.marketStore.fetch_favs()},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e},scrollLeft(){const e=document.querySelector(".nf"),t=e.scrollLeft;e.scroll({left:t-200,behavior:"smooth"})},scrollRight(){const e=document.querySelector(".nf"),t=e.scrollLeft;e.scroll({left:t+200,behavior:"smooth"})},addToWatchlist(e,t,r){axios.post("/user/watchlist/store",{currency:e,pair:t,type:r}).then(s=>{this.$toast[s.type](s.message),this.fetchFavs()}).catch(s=>{this.$toast.error(s.response.data)})},removeFromWatchlist(e){axios.post("/user/watchlist/delete",{id:e}).then(t=>{this.$toast.success(t.message),this.fetchFavs()}).catch(t=>{this.$toast.error("Market Already Removed From Watchlist")})},contains(e,t){var r=0;return t.forEach(function(s){r=r+e.includes(s)}),r===1},formatTotal(e){return ccxt.decimalToPrecision(e,ccxt.ROUND,3,ccxt.DECIMAL_PLACES,ccxt.PAD_WITH_ZERO)}}},Fe={class:"Markets border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},Te={class:"mb-4 flex border-gray-200 dark:border-gray-800"},Be={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden bg-gray-200 text-center text-sm font-medium dark:bg-gray-800",role:"tablist"},Ce=["onClick"],Oe={id:"myTabContent",class:"px-3"};function Me(e,t,r,s,d,o){const n=F("MarketList");return h(),f("div",Fe,[a("div",Te,[a("button",{class:"-mb-px bg-gray-200 px-1 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700",onClick:t[0]||(t[0]=D(l=>o.scrollLeft(),["prevent"]))},t[5]||(t[5]=[a("i",{class:"bi bi-chevron-left text-warning"},null,-1)])),a("ul",Be,[a("li",null,[a("small",null,[a("a",{class:T(["inline-block px-2 py-1 text-gray-600 dark:text-gray-300",o.isActive("fav")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),onClick:t[1]||(t[1]=l=>o.setActive("fav"))},t[6]||(t[6]=[a("i",{class:"bi bi-star bi-icon"},null,-1)]),2)])]),(h(!0),f(q,null,J(d.markets,(l,y,v)=>(h(),f("li",{key:v},[a("small",null,[a("a",{class:T(["inline-block px-2 py-1 text-gray-600 dark:text-gray-300",o.isActive(y)?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),onClick:S=>o.setActive(y)},m(y),11,Ce)])]))),128))]),a("button",{class:"-mb-px bg-gray-200 px-1 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700",onClick:t[2]||(t[2]=D(l=>o.scrollRight(),["prevent"]))},t[7]||(t[7]=[a("i",{class:"bi bi-chevron-right text-warning fs-6"},null,-1)]))]),a("div",Oe,[d.activeItem==="fav"?(h(),N(n,{key:s.marketStore.favs.length,list:Object.values(s.marketStore.favs),type:r.type,subtype:r.subtype,iffav:"true",ifeco:"true",onFetchFavs:t[3]||(t[3]=l=>s.marketStore.fetch_favs())},null,8,["list","type","subtype"])):I("",!0),(h(!0),f(q,null,J(d.markets,(l,y,v)=>(h(),f("div",{key:v,class:T(o.isActive(y)?"":"hidden")},[d.activeItem===y?(h(),N(n,{key:l.length,list:Object.values(l),type:r.type,subtype:r.subtype,ifeco:"true",onFetchFavs:t[4]||(t[4]=S=>s.marketStore.fetch_favs())},null,8,["list","type","subtype"])):I("",!0)],2))),128))])])}const Pe=E(Ae,[["render",Me]]),Ie={props:{market:{type:Object,required:!0},precisionAmount:{type:[Number,String],required:!0,default:6},precisionPrice:{type:[Number,String],required:!0,default:6}},data(){return{sideLength:12,activeItem:"marketTrades",trades:[],subscriptionOrderBook:null}},computed:{visibleTrades(){return this.trades.slice(0,this.sideLength)},currency(){return this.market.currency},pair(){return this.market.pair}},watch:{currency:{handler(){this.updateWebSocketSubscription()}},pair:{handler(){this.updateWebSocketSubscription()}},$route(e,t){this.updateWebSocketSubscription()}},beforeUnmount(){this.disconnectWebSocket()},mounted(){this.updateWebSocketSubscription()},methods:{isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e},tabClass(e){return this.isActive(e)?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"},priceFormatter(e,t=8,r=2,s=","){return e?(e=parseInt(e)!==0?parseFloat(e).toFixed(r):parseFloat(e).toFixed(t),e=parseInt(e)!==0?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,s):e,e):0},tradeColor(e){return e==="SELL"?"rgb(246,70,93)":"rgb(14,203,129)"},updateWebSocketSubscription(){this.subscriptionOrderBook&&(this.subscriptionOrderBook.stopListening(".orderbook"),window.Echo.leave(this.subscriptionOrderBook.name),this.subscriptionOrderBook=null);const e=`orderbook-data.${this.currency}.${this.pair}`;this.subscriptionOrderBook=window.Echo.private(e),this.subscriptionOrderBook.listen(".orderbook",async t=>{this.trades.unshift(t.orderbook),this.trades=this.trades.slice(0,this.sideLength)})},disconnectWebSocket(){this.subscriptionOrderBook&&(this.subscriptionOrderBook.stopListening(".orderbook"),window.Echo.leave(this.subscriptionOrderBook.name),this.subscriptionOrderBook=null)},formatTime(e){return new Date(e).toLocaleTimeString("en-US")}}},Ne={class:"Trades border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},De={class:"w-full bg-gray-200 dark:bg-gray-800"},Ee={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden text-center",role:"tablist"},Le={id:"tradesContent"},We={class:"table-responsive"},$e={class:"text-dark table-sm table"},Ue={class:"text-muted"},ze={class:"text-start",scope:"col"},Ve={class:"text-end",scope:"col"},He={class:"text-end",scope:"col"},Re={id:"tradeTable",class:"trade"},qe={class:"text-end"},je={class:"text-end"};function Ke(e,t,r,s,d,o){return h(),f("div",Ne,[a("div",De,[a("ul",Ee,[a("li",null,[a("a",{id:"marketTrades-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.tabClass("marketTrades")]),type:"button",role:"tab","aria-controls":"marketTrades","aria-selected":"false",onClick:t[0]||(t[0]=D(n=>o.setActive("marketTrades"),["prevent"]))},m(e.$t("Market Trades")),3)])])]),a("div",Le,[a("div",{id:"marketTrades",class:T(["px-3 pt-3",{hidden:!o.isActive("marketTrades")}])},[a("div",We,[a("table",$e,[a("thead",Ue,[a("tr",null,[a("th",ze,m(e.$t("Price")),1),a("th",Ve,m(e.$t("Amount")),1),a("th",He,m(e.$t("Time")),1)])]),a("tbody",Re,[(h(!0),f(q,null,J(o.visibleTrades,(n,l)=>(h(),f("tr",{key:l},[a("td",{class:"text-start",style:ue({color:o.tradeColor(n.type)})},m(o.priceFormatter(n.price,r.precisionPrice)),5),a("td",qe,m(o.priceFormatter(n.amount,r.precisionAmount)),1),a("td",je,m(o.formatTime(n.created)),1)]))),128))])])])],2)])])}const Ye=E(Ie,[["render",Ke]]),j=me("eco",{state:()=>({marketOrder:!1,bestAsk:0,bestBid:0,market:[],open_orders:[],closed_orders:[],walletSymbol:null,walletCurrency:null,loading:!1,timeframe:localStorage.getItem("lastTimeframe")||"HOUR_1",precisionAmount:6,precisionPrice:6}),actions:{async fetch(e,t){await axios.post("/user/eco/index",{currency:e,pair:t}).then(r=>{r.message=="Verify your identify first!"&&(window.location.href="/user/kyc"),this.market=r})},async fetchOrders(){await axios.post("/user/eco/orders",{currency:this.market.currency,currency_chain:this.market.currency_chain,pair:this.market.pair,pair_chain:this.market.pair_chain}).then(e=>{this.open_orders=e.open_orders,this.closed_orders=e.closed_orders,this.open_orders.errorCode&&this.fetchOrders()}).catch(e=>{})},closeModal(){this.isShowModal=!1},showModal(){this.isShowModal=!0},async fetchWallets(){this.fetchWallet(this.market.currency,this.market.currency_chain),this.fetchWallet(this.market.pair,this.market.pair_chain)},async fetchWallet(e,t){await axios.post("/user/eco/wallet/balance",{symbol:e.includes("_")?e.substring(0,e.indexOf("_")):e,postfix:e.includes("_")?e.substring(e.indexOf("_")):null,chain:t}).then(r=>{e==this.market.currency?this.walletSymbol=r.balance:e==this.market.pair&&(this.walletCurrency=r.balance)}).catch(r=>{this.fetchWallet(e.includes("_")?e.substring(0,e.indexOf("_")):e,t)})},async createWallet(e,t){this.loading=!0,await axios.post("/user/eco/wallet/store",{chain:t,network:t,symbol:e.includes("_")?e.substring(0,e.indexOf("_")):e,postfix:e.includes("_")?e.substring(e.indexOf("_")):null}).then(r=>{Array.isArray(r)?r.forEach(s=>{$toast[s.type](s.message)}):$toast[r.type](r.message),this.fetchWallet(e,t)}).catch(r=>{$toast.error(r.response.data.message)}).finally(()=>{this.loading=!1})},async executeTrade(e,t,r,s){this.loading=!0;const d=t==="market",o=e==="BUY";if(d&&(o?this.bestAsk:this.bestBid)>0||!d&&r>0)await axios.post("/user/eco/trade/store",{amount:Number.parseFloat(s),price:d?o?Number.parseFloat(this.bestAsk):Number.parseFloat(this.bestBid):Number.parseFloat(r),symbol:this.market.currency,symbol_chain:this.market.currency_chain,currency:this.market.pair,currency_chain:this.market.pair_chain,tradeType:t,type:e,taker:o?this.market.taker:void 0,maker:o?void 0:this.market.maker,timeframe:this.timeframe}).then(n=>{if(n.messages)n.message.forEach(l=>{$toast[n.type](l)});else{$toast[n.type](n.message),this.fetchOrders();const l=Number.parseFloat(s),y=d?o?Number.parseFloat(this.bestAsk):Number.parseFloat(this.bestBid):Number.parseFloat(r);o?this.walletCurrency-=l*y:this.walletSymbol-=l,this.fetchWallets()}}).catch(n=>{console.log(n)}).finally(()=>{this.loading=!1});else{const n=d?o?"No Market Price, Please Do Limit Order":"Please wait for orderbook to load":"Please set a valid price";$toast.error(n),this.loading=!1}}},persist:!0}),Ze={name:"KLineWidget",props:{market:{type:Object,required:!0}},setup(){return{ecoStore:j()}},data(){return{chart:null,bars:[],loops:{},cachedData:{},interval:localStorage.getItem("lastInterval")||"1h",widget:null,duration:864e5,now:Date.now(),lastprice:[],subscription:null,supported_resolutions:["1","3","5","15","30","60","240","720","D","W","M"],intervalMap:{"1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","4h":"240","12h":"720","1d":"D",w:"W",m:"M"},intervalFetch:{"1m":"MIN_1","3m":"MIN_3","5m":"MIN_5","15m":"MIN_15","30m":"MIN_30","1h":"HOUR_1","4h":"HOUR_4","12h":"HOUR_12","1d":"DAY",w:"WEEK",m:"MONTH"}}},computed:{datafeed(){return this.createDataFeed()}},watch:{async $route(e,t){const r=`${t.params.symbol}-${t.params.currency}-${this.intervalFetch[this.interval]}`,s=`${e.params.symbol}-${e.params.currency}-${this.intervalFetch[this.interval]}`;this.loops[r]=!1,this.bars=[],await this.$nextTick(),this.loops[s]=!0,this.datafeed=this.createDataFeed(),this.updateWebSocketSubscription(),this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[this.interval])},interval:{handler:async function(e,t){if(e!==t){const r=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[t]}`,s=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[e]}`;this.loops[r]=!1,this.bars=[],await this.$nextTick(),this.loops[s]=!0,this.datafeed=this.createDataFeed(),this.ecoStore.timeframe=this.intervalFetch[e],localStorage.setItem("lastInterval",e),localStorage.setItem("lastTimeframe",this.intervalFetch[e]),this.updateWebSocketSubscription(),this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[e])}},immediate:!1}},beforeUnmount(){Object.keys(this.loops).forEach(e=>{this.loops[e]=!1})},mounted(){this.initTradingView()},created(){this.updateWebSocketSubscription();const e=`${this.market.currency}-${this.market.pair}-${this.intervalFetch[this.interval]}`;this.loops[e]=!0},methods:{updateWebSocketSubscription(){this.subscription&&(this.subscription.stopListening(".candlestick"),window.Echo.leave(this.subscription.name),this.subscription=null);const e=`chart-data.${this.market.currency}.${this.market.pair}.${this.intervalFetch[this.interval]}`;this.subscription=window.Echo.private(e),this.subscription.listen(".candlestick",async t=>{for(const r of t.chartData){const s={timestamp:r.timestamp,high:parseFloat(r.high),low:parseFloat(r.low),open:parseFloat(r.open),close:parseFloat(r.close),volume:parseFloat(r.volume)};await this.updateBar(s)}})},async loopHistory(e,t,r){const s=`${e}-${t}-${r}`,d=this.getBarDuration(this.intervalMap[this.interval]),o=199;let n;this.bars&&this.bars.length>0?n=this.bars[0].time:n=Date.now()-o*d;let l=0;const y=10;for(;!this.stopLoop&&this.loops[s];){const v=n-o*d,S=await this.fetchHistory(v,n);S&&S.length==0?l++:l=0,l>=y&&(this.stopLoop=!1),n=v,await new Promise(C=>setTimeout(C,5e3))}},async fetchHistory(e,t){if(e!=null&&!isNaN(e)&&t!=null&&!isNaN(t))try{return await axios.get(`/user/eco/chart/${this.market.currency}/${this.market.pair}/${this.intervalFetch[this.interval]}/${e}/${t}`).then(s=>Object.values(s))}catch{return[]}else return[]},async fetchOHLCV(){return await axios.get(`/user/eco/chart/${this.market.currency}/${this.market.pair}/${this.intervalFetch[this.interval]}/json`).then(t=>t).catch(t=>{throw t})},async getBars(e){var t=this.market.currency+"/"+this.market.pair;if(!e.firstDataRequest)return{bars:[],meta:{noData:!0}};if(e.resolution!==this.intervalMap[this.interval])for(let l in this.intervalMap)this.intervalMap[l]===e.resolution&&(this.interval=l);const r=await this.fetchOHLCV(t);if(this.createEmptyBars(),!r||!r.length)return{bars:[],meta:{noData:!0}};r.sort((l,y)=>l.timestamp-y.timestamp);const s=[];let d=0;const o=Date.now(),n=this.getBarDuration(e.resolution);for(let l=0;l<r.length;l++){const y=r[l];if(y.timestamp===void 0)continue;if(y.timestamp===d&&(y.timestamp+=1),d!==0)for(let S=d+n;S<y.timestamp;S+=n){const C=s[s.length-1],A={time:S,open:C.close,high:C.close,low:C.close,close:C.close,volume:0};s.push(A)}const v={time:y.timestamp,open:d===0?parseFloat(y.open):s[s.length-1].close,high:parseFloat(y.high),low:parseFloat(y.low),close:parseFloat(y.close),volume:parseFloat(y.volume)};s.push(v),d=y.timestamp}for(let l=d+n;l<o;l+=n){const y=s[s.length-1],v={time:l,open:y.close,high:y.close,low:y.close,close:y.close,volume:0};s.push(v)}return s.sort((l,y)=>l.time>y.time?1:-1),this.bars=s,window.location.href.indexOf(this.market.currency+"-"+this.market.pair)>-1&&this.loopHistory(this.market.currency,this.market.pair,this.intervalFetch[this.interval]),{bars:s,meta:{noData:!s.length}}},async createEmptyBars(){const e=async()=>{if(window.location.href.indexOf(this.market.currency+"-"+this.market.pair)>-1){const t=this.bars.some(r=>r.volume!==0);try{const r=Date.now(),s=this.getBarDuration(this.intervalMap[this.interval]),d=Math.floor(r/s)*s;if(!t&&this.bars.length===0){const o={time:d,open:this.ecoStore.bestAsk||0,high:this.ecoStore.bestAsk||0,low:this.ecoStore.bestAsk||0,close:this.ecoStore.bestAsk||0,volume:0};this.datafeed.updateKLine(o),this.bars.push(o)}else if(this.bars.length>0&&t){const o=this.bars[this.bars.length-1];if(r>o.time+s){const n={time:o.time+s,open:o.close,high:o.close,low:o.close,close:o.close,volume:0};this.datafeed.updateKLine(n),this.bars.push(n)}}setTimeout(e,1e3)}catch(r){console.log(r)}}};e()},async updateBar(e){const t=this.bars[this.bars.length-1],r=this.getBarDuration(this.intervalMap[this.interval]),s=t.time-t.time%r;if(e.timestamp>=s&&e.timestamp<s+r)t.high=Math.max(t.high,parseFloat(e.high)),t.low=Math.min(t.low,parseFloat(e.low)),t.close=parseFloat(e.close),t.volume+=parseFloat(e.volume),this.datafeed.updateKLine(t);else if(e.timestamp>t.time){const o={time:e.timestamp,open:t.close,high:parseFloat(e.high),low:parseFloat(e.low),close:parseFloat(e.close),volume:parseFloat(e.volume)};this.datafeed.updateKLine(o),this.bars.push(o)}},createDataFeed(){return new oe.DataFeed({getBars:e=>this.getBars(e),fetchResolveSymbol:()=>this.resolveSymbol(),fetchConfiguration:()=>new Promise(e=>{e({supported_resolutions:this.supportedResolutions})})})},resolveSymbol(){return new Promise(e=>{var t=this.market.currency+"/"+this.market.pair;e({ticker:t,name:t,full_name:t,description:t,type:"crypto",session:"24x7",exchange:gnl.sitename.toUpperCase(),listed_exchange:gnl.sitename.toUpperCase(),timezone:"Etc/UTC",format:"price",minmov:1,has_intraday:!0,supported_resolutions:this.supported_resolutions,volume_precision:2,data_status:"streaming",pricescale:100})})},getBarDuration(e){switch(e){case"1":return 60*1e3;case"3":return 3*60*1e3;case"5":return 5*60*1e3;case"15":return 15*60*1e3;case"30":return 30*60*1e3;case"60":return 60*60*1e3;case"240":return 4*60*60*1e3;case"720":return 12*60*60*1e3;case"D":return 24*60*60*1e3;case"W":return 7*24*60*60*1e3;case"M":return 30*24*60*60*1e3;default:return 60*1e3}},getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},initTradingView(){const e=document.getElementById("tv_chart_container");e&&e.remove();const t=document.createElement("div");t.id="tv_chart_container",t.style.height="100%",document.querySelector("#creatable").appendChild(t);var s=this.market.currency+"/"+this.market.pair;this.widget=new oe.widget({fullscreen:!1,width:"100%",height:"100%",symbol:s,interval:this.intervalMap[this.interval],container_id:"tv_chart_container",datafeed:this.datafeed,library_path:"/charting_library/",locale:"en",theme:theme=="dark"?"Dark":"Light",timezone:"Etc/UTC",allow_symbol_change:!1,charts_storage_api_version:"1.1",client_id:"tradingview.com",user_id:"public_user_id",disabled_features:["header_compare","study_dialog_search_control","symbol_search_hot_key","header_symbol_search","go_to_date","compare_symbol","timezone_menu","timeframes_toolbar","header_screenshot"],enabled_features:["dont_show_boolean_study_arguments","use_localstorage_for_settings","save_chart_properties_to_local_storage","side_toolbar_in_fullscreen_mode","hide_last_na_study_output","constraint_dialogs_movement","hide_left_toolbar_by_default"]}),this.widget.onChartReady(()=>{this.chart=this.widget.chart()})}}};function Ge(e,t,r,s,d,o){return null}const Je=E(Ze,[["render",Ge]]);function Qe(e){return Math.floor(e.valueOf())===e.valueOf()?0:e.toString().split(".")[1].length||0}const Xe={components:{Button:re,AmountInput:ge,TotalInput:fe,PriceInput:ke},props:{orderType:String,formType:String},setup(e){const{t}=he(),r=j(),s=H(!1),d=B(()=>Number.parseFloat(r.market.min_amount)||1e-4),o=B(()=>Number.parseFloat(r.market.max_amount)||1e4),n=B(()=>{var k;return r.market&&r.market.min_amount&&((k=Number.parseFloat(r.market.min_amount).toString().split(".")[1])==null?void 0:k.length)||6}),l=H(d.value??0),y=H(0),v=H(0),S=B(()=>{const k=r.market.currency;return k.includes("_")?k.substring(0,k.indexOf("_")):k}),C=B(()=>{const k=r.market.pair;return k.includes("_")?k.substring(0,k.indexOf("_")):k}),A=k=>{l.value=k},w=k=>{y.value=k},Q=k=>{v.value=k},K=B(()=>e.formType+(e.orderType==="buy"?"OrderBtnBuy":"OrderBtnSell")),Y=B(()=>e.orderType==="buy"?"green":"red"),W=B(()=>e.formType=="market"?e.orderType==="buy"?r.bestAsk>0:r.bestBid>0:!0),U=B(()=>W.value?(e.orderType==="buy"?t("Buy"):t("Sell"))+" "+r.market.currency:e.orderType==="buy"?"No Asks Founds":"No Bids Found"),X=()=>{e.formType==="market"?e.orderType==="buy"?r.executeTrade("BUY","market",null,l.value):r.executeTrade("SELL","market",null,l.value):e.formType==="limit"&&(e.orderType==="buy"?r.executeTrade("BUY","limit",v.value,l.value):r.executeTrade("SELL","limit",v.value,l.value))},L=(k,M)=>{const i=e.formType==="market"?$.value:v.value,u=(e.orderType==="buy"?r.market.taker:r.market.maker)/100,c=k*(M/100)/i,b=c*u;return parseFloat(c-b).toFixed(n.value)};R(l,(k,M)=>{k!==M&&(s.value=!0)},{immediate:!1}),R(v,()=>{z()});const Z=(k,M)=>{const i=k*M/100;return e.orderType==="buy"?k+i:k-i},ee=k=>{if(r.loading)return;if(!r.market.currency&&!r.market.pair){$toast.error(`Create ${e.orderType==="buy"?r.market.pair:r.market.currency} Wallet First`);return}if(!r.bestBid&&!r.bestAsk){$toast.error("Waiting For Orderbook...");return}const M=parseFloat(r.walletCurrency),i=parseFloat(r.walletSymbol);if(v.value===0&&(v.value=$.value),e.orderType==="buy"){y.value=parseFloat(M*k/100).toFixed(n.value);const u=y.value/(1+r.market.taker/100);l.value=parseFloat(u/(e.formType==="market"?$.value:v.value)).toFixed(n.value)}else{l.value=parseFloat(i*k/100).toFixed(n.value);const u=l.value*(e.formType==="market"?$.value:v.value);y.value=parseFloat(u*(1-r.market.maker/100)).toFixed(n.value)}z()},z=()=>{if(s.value&&!r.loading&&r.walletCurrency&&r.walletSymbol){let k,M,i;if(e.orderType==="buy"?(k=r.walletCurrency,M=r.walletSymbol,i=r.market.taker):(k=r.walletSymbol,M=r.walletCurrency,i=r.market.maker),k===null){$toast.error("Create "+M+" Wallet First");return}if(e.formType==="market"&&r.bestBid===null){$toast.error("No spot price detected, Make a limit order first");return}const u=e.formType==="market"||v.value===0?$.value:v.value,c=l.value*u,b=Z(c,i);if(k<b){$toast.error("Order price higher than your wallet balance");return}y.value=b.toFixed(n.value)}},$=B(()=>r[e.orderType==="buy"?"bestAsk":"bestBid"]),te=()=>{const k=e.orderType==="buy"?r.bestAsk||r.bestBid:r.bestBid||r.bestAsk;v.value=k,z()};return ie(()=>{s.value=!1}),{ecoStore:r,submitForm:X,buttonId:K,buttonColor:Y,orderAvailability:W,buttonText:U,updateAmount:A,updateTotal:w,updatePrice:Q,calculatePercentage:ee,calculateTotalAmount:L,calculateTotal:z,minAmount:d,maxAmount:o,precisionAmount:n,amount:l,total:y,price:v,currencyName:S,pairName:C,getBestPrice:te}}};function et(e,t,r,s,d,o){const n=F("PriceInput"),l=F("AmountInput"),y=F("TotalInput"),v=F("Button");return h(),f("form",{class:"space-y-3 text-center",onSubmit:t[3]||(t[3]=D((...S)=>s.submitForm&&s.submitForm(...S),["prevent"]))},[r.formType=="limit"?(h(),N(n,{key:0,modelValue:s.price,"onUpdate:modelValue":t[0]||(t[0]=S=>s.price=S),"order-type":r.orderType,"pair-name":s.pairName,disabled:s.ecoStore.loading,"is-eco":!0,onGetBestPrice:s.getBestPrice},null,8,["modelValue","order-type","pair-name","disabled","onGetBestPrice"])):I("",!0),p(l,{modelValue:s.amount,"onUpdate:modelValue":t[1]||(t[1]=S=>s.amount=S),"order-type":r.orderType,"form-type":r.formType,"min-amount":s.minAmount,"max-amount":s.maxAmount,"precision-amount":s.precisionAmount,"currency-name":s.currencyName,disabled:s.ecoStore.loading,onCalculateTotal:s.calculateTotal,onCalculatePercentage:s.calculatePercentage},null,8,["modelValue","order-type","form-type","min-amount","max-amount","precision-amount","currency-name","disabled","onCalculateTotal","onCalculatePercentage"]),p(y,{modelValue:s.total,"onUpdate:modelValue":t[2]||(t[2]=S=>s.total=S),"taker-fee":s.ecoStore.market.taker,"maker-fee":s.ecoStore.market.maker,"order-type":r.orderType,disabled:!0,"pair-name":s.pairName},null,8,["modelValue","taker-fee","maker-fee","order-type","pair-name"]),p(v,{id:s.buttonId,color:s.buttonColor,outline:"",size:"sm",class:T(["w-full",r.formType+"Type"]),loading:s.ecoStore.loading,disabled:s.ecoStore.loading||!s.orderAvailability},{default:_(()=>[O(m(s.buttonText),1)]),_:1},8,["id","color","class","loading","disabled"])],32)}const tt=E(Xe,[["render",et]]),rt={components:{Button:re,OrderForm:tt},props:{market:{type:Object,required:!0}},setup(){const e=be(),t=j();return{userStore:e,ecoStore:t,countDecimals:Qe}},data(){return{activeItem:"limit",loading:!1}},computed:{symbol(){return this.ecoStore.market.currency},currency(){return this.ecoStore.market.pair},symbol_chain(){return this.ecoStore.market.currency_chain},currency_chain(){return this.ecoStore.market.pair_chain}},watch:{symbol:{handler(){this.ecoStore.fetchWallets()}},currency:{handler(){this.ecoStore.fetchWallets()}}},mounted(){this.ecoStore.fetchWallets()},methods:{isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},st={class:"Order border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},at={class:"w-full bg-gray-200 dark:bg-gray-800"},ot={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden text-center",role:"tablist"},it={role:"presentation"},nt=["aria-selected"],lt={role:"presentation"},ct=["aria-selected"],dt={role:"presentation"},ut=["aria-selected"],mt={id:"myTabContent",class:"px-3 py-3"},ht={class:"grid grid-cols-2 gap-5"},pt={class:"grid grid-cols-2 gap-5"},yt={class:"grid grid-cols-2 gap-5"},bt={for:"basic-url",class:"border-1 order-label peer"},gt={class:"text-dark"},ft={key:1,class:"flex"},kt=["value"],vt={class:"order-span-2"},_t={for:"basic-url",class:"border-1 order-label peer"},xt={class:"text-dark"},wt={key:1,class:"flex"},St=["value"],At={class:"order-span-2"};function Ft(e,t,r,s,d,o){const n=F("OrderForm"),l=F("Button");return h(),f("div",st,[a("div",at,[a("ul",ot,[a("li",it,[a("button",{id:"spot-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("spot")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"spot","aria-selected":!!o.isActive("spot"),onClick:t[0]||(t[0]=y=>o.setActive("spot"))},m(e.$t("Spot")),11,nt)]),a("li",lt,[a("button",{id:"limit-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("limit")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"limit","aria-selected":!!o.isActive("limit"),onClick:t[1]||(t[1]=y=>o.setActive("limit"))},m(e.$t("Limit")),11,ct)]),a("li",dt,[a("button",{id:"wallets-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("wallets")?"active-tab":"inactive-tab"]),type:"button",role:"tab","aria-controls":"wallets","aria-selected":!!o.isActive("wallets"),onClick:t[2]||(t[2]=y=>o.setActive("wallets"))},m(e.$t("Wallets")),11,ut)])])]),a("div",mt,[a("div",{id:"spot",class:T({hidden:!o.isActive("spot")}),role:"tabpanel","aria-labelledby":"spot-tab"},[a("div",ht,[p(n,{"order-type":"buy","form-type":"market"}),p(n,{"order-type":"sell","form-type":"market"})])],2),a("div",{id:"limit",class:T({hidden:!o.isActive("limit")}),role:"tabpanel","aria-labelledby":"limit-tab"},[a("div",pt,[p(n,{"order-type":"buy","form-type":"limit"}),p(n,{"order-type":"sell","form-type":"limit"})])],2),a("div",{id:"wallets",class:T({hidden:!o.isActive("wallets")}),role:"tabpanel","aria-labelledby":"wallets-tab"},[a("div",yt,[(h(),f("div",{key:"sym"+s.ecoStore.walletSymbol},[a("label",bt,[a("a",gt,m(o.symbol.includes("_")?o.symbol.substring(0,o.symbol.indexOf("_")):o.symbol)+" "+m(e.$t("Wallet")),1)]),s.ecoStore.walletSymbol==null?(h(),f("form",{key:0,onSubmit:t[3]||(t[3]=D(y=>s.ecoStore.createWallet(s.ecoStore.market.currency,s.ecoStore.market.currency_chain),["prevent"]))},[p(l,{color:"green",outline:"",size:"sm",loading:s.ecoStore.loading,disabled:s.ecoStore.loading},{default:_(()=>[O(m(e.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(h(),f("div",ft,[(h(),f("input",{key:s.ecoStore.walletSymbol,type:"number",class:"order-input",value:s.ecoStore.walletSymbol,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,kt)),a("span",vt,m(s.ecoStore.market.currency),1)]))])),(h(),f("div",{key:"cur"+s.ecoStore.walletCurrency},[a("label",_t,[a("a",xt,m(o.currency.includes("_")?o.currency.substring(0,o.currency.indexOf("_")):o.currency)+" "+m(e.$t("Wallet")),1)]),s.ecoStore.walletCurrency==null?(h(),f("form",{key:0,onSubmit:t[4]||(t[4]=D(y=>s.ecoStore.createWallet(s.ecoStore.market.pair,s.ecoStore.market.pair_chain),["prevent"]))},[p(l,{color:"green",outline:"",size:"sm",loading:s.ecoStore.loading,disabled:s.ecoStore.loading},{default:_(()=>[O(m(e.$t("Create Wallet")),1)]),_:1},8,["loading","disabled"])],32)):(h(),f("div",wt,[(h(),f("input",{key:s.ecoStore.walletCurrency,type:"number",class:"order-input",value:s.ecoStore.walletCurrency,readonly:"","aria-label":"Amount (to the nearest dollar)"},null,8,St)),a("span",At,m(s.ecoStore.market.pair),1)]))]))])],2)])])}const Tt=E(rt,[["render",Ft]]),Bt={components:{toDate:_e,toMoney:ve,Filter:xe,Col:we,Button:re},props:{market:{type:Object,required:!0},precisionAmount:{type:[Number,String],required:!0,default:6},precisionPrice:{type:[Number,String],required:!0,default:6}},setup(){return{ecoStore:j()}},data(){return{activeItem:"open-orders",currentPage:1,totalPages:0,currentPageOpen:1,totalPagesOpen:0,loadingCancel:!1}},computed:{currency(){return this.market.currency},pair(){return this.market.pair},openOrders(){return this.ecoStore.open_orders||[]},closedOrders(){return this.ecoStore.closed_orders||[]}},watch:{currency:{handler(){this.ecoStore.open_orders=[],this.fetchOrders()}},pair:{handler(){this.ecoStore.open_orders=[],this.fetchOrders()}}},async mounted(){await this.ecoStore.fetchOrders()},methods:{async fetchOrders(){await this.ecoStore.fetchOrders()},cancelOrder(e){this.loadingCancel=!0,axios.post("/user/eco/order/cancel",{id:e,currency:this.currency,pair:this.pair}).then(t=>{t.data?t.message.forEach(r=>{$toast[t.type](r)}):$toast[t.type](t.message),this.fetchOrders()}).catch(t=>{}).finally(()=>{this.loadingCancel=!1})},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},Ct={class:"border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900",style:{margin:"0 -20px"}},Ot={id:"myTab",class:"nf flex-cols -mb-px flex overflow-x-hidden bg-gray-200 text-center dark:bg-gray-800",role:"tablist"},Mt={class:"bg-gray-100 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400"},Pt={class:"py-3 px-6","data-label":"Date"},It={"data-label":"TxHash",class:"text-uppercase text-center"},Nt={"data-label":"Symbol",class:"text-uppercase text-center"},Dt={"data-label":"Side",class:"text-uppercase text-center"},Et={key:0,class:"badge bg-success"},Lt={key:1,class:"badge bg-danger"},Wt={"data-label":"Price"},$t={"data-label":"Amount"},Ut={"data-label":"Filled"},zt={"data-label":"Status",class:"text-center"},Vt={class:"badge bg-primary"},Ht=["loading","disabled","onClick"],Rt={key:1,class:"badge bg-warning"},qt={key:1},jt={class:"text-center",colspan:"100%"},Kt={class:"sr-only"},Yt={class:"sr-only"},Zt={class:"bg-gray-100 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400"},Gt={class:"py-3 px-6","data-label":"Date"},Jt={"data-label":"TxHash",class:"text-uppercase"},Qt={"data-label":"Symbol",class:"text-uppercase"},Xt={"data-label":"Side",class:"text-uppercase text-center"},er={key:0,class:"badge bg-success"},tr={key:1,class:"badge bg-danger"},rr={"data-label":"Price"},sr={"data-label":"Amount"},ar={"data-label":"Filled"},or={"data-label":"Status"},ir={class:"badge bg-success"},nr={key:1},lr={class:"text-center",colspan:"100%"},cr={class:"sr-only"},dr={class:"sr-only"};function ur(e,t,r,s,d,o){const n=F("Col"),l=F("VTh"),y=F("toDate"),v=F("toMoney"),S=F("VTable"),C=F("VTPagination");return h(),f("div",Ct,[a("ul",Ot,[a("li",null,[a("a",{id:"open-orders-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("open-orders")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),type:"button",role:"tab","aria-controls":"open-orders","aria-selected":"false",onClick:t[0]||(t[0]=D(A=>o.setActive("open-orders"),["prevent"]))},m(e.$t("Open Orders")),3)]),a("li",null,[a("a",{id:"closed-orders-tab",class:T(["inline-block py-2 pl-3 pr-4 text-xs font-medium",o.isActive("closed-orders")?"border-gray-300 bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-300":"cursor-pointer border-transparent bg-gray-200 text-gray-400 hover:border-gray-300 hover:bg-gray-300 hover:text-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-gray-300"]),type:"button",role:"tab","aria-controls":"closed-orders","aria-selected":"false",onClick:t[1]||(t[1]=D(A=>o.setActive("closed-orders"),["prevent"]))},m(e.$t("Order History")),3)])]),a("div",{id:"open-orders",class:T(["pt-3",o.isActive("open-orders")?"":"hidden"]),role:"tabpanel",style:{"min-height":"300px"}},[p(S,{"current-page":d.currentPageOpen,"onUpdate:currentPage":t[2]||(t[2]=A=>d.currentPageOpen=A),class:"w-full text-left text-sm text-gray-500 dark:text-gray-400",data:o.openOrders,"page-size":10,"hide-sort-icons":!0,onTotalPagesChanged:t[3]||(t[3]=A=>d.totalPagesOpen=A)},{head:_(()=>[a("tr",Mt,[p(l,{"sort-key":"created",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Date"})]),_:1}),p(l,{"sort-key":"order_id",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"TxHash"})]),_:1}),p(l,{"sort-key":"symbol",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Symbol"})]),_:1}),p(l,{"sort-key":"side",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Side"})]),_:1}),p(l,{"sort-key":"price",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Price"})]),_:1}),p(l,{"sort-key":"amount",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Amount"})]),_:1}),p(l,{"sort-key":"filled",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Filled"})]),_:1}),p(l,{"sort-key":"status",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Status"})]),_:1})])]),body:_(({rows:A})=>[o.openOrders&&o.openOrders.length>0?(h(!0),f(q,{key:0},J(A,w=>(h(),f("tr",{key:w.id,class:"border-b bg-white dark:border-gray-700 dark:bg-gray-800"},[a("td",Pt,[p(y,{time:w.created},null,8,["time"])]),a("td",It,m(w.id),1),a("td",Nt,m(w.pair),1),a("td",Dt,[w.type=="BUY"?(h(),f("span",Et,m(e.$t("Buy")),1)):(h(),f("span",Lt,m(e.$t("Sell")),1))]),a("td",Wt,[p(v,{num:w.price,decimals:r.precisionPrice},null,8,["num","decimals"]),O(" "+m(o.pair),1)]),a("td",$t,[p(v,{num:w.amount,decimals:r.precisionAmount},null,8,["num","decimals"]),O(" "+m(o.currency),1)]),a("td",Ut,[p(v,{num:w.fill,decimals:r.precisionAmount},null,8,["num","decimals"]),O(" "+m(o.currency),1)]),a("td",zt,[w.fill==0?(h(),f(q,{key:0},[a("span",Vt,m(e.$t("Pending")),1),a("button",{class:"btn btn-sm btn-danger",loading:d.loadingCancel,disabled:d.loadingCancel,type:"button",onClick:Q=>o.cancelOrder(w.id)},m(e.$t("Cancel")),9,Ht)],64)):w.fill>0&&w.fill!=w.amount?(h(),f("span",Rt,m(e.$t("Filling")),1)):I("",!0)])]))),128)):(h(),f("tr",qt,[a("td",jt,[t[8]||(t[8]=a("div",{class:"flex w-full justify-center"},[a("img",{height:"128",width:"128",src:"https://assets.staticimg.com/pro/2.0.4/images/empty.svg",alt:""})],-1)),O(" "+m(e.$t("No Data Found")),1)])]))]),_:1},8,["current-page","data"]),p(C,{currentPage:d.currentPageOpen,"onUpdate:currentPage":t[4]||(t[4]=A=>d.currentPageOpen=A),class:"flex items-center justify-between p-3","aria-label":"Table navigation","total-pages":d.totalPagesOpen,"max-page-links":3,"boundary-links":!0},{firstPage:_(()=>[O(m(e.$t("First")),1)]),lastPage:_(()=>[O(m(e.$t("Last")),1)]),next:_(()=>[a("span",Kt,m(e.$t("Next")),1),t[9]||(t[9]=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1))]),previous:_(()=>[a("span",Yt,m(e.$t("Previous")),1),t[10]||(t[10]=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1))]),_:1},8,["currentPage","total-pages"])],2),a("div",{id:"closed-orders",class:T(["pt-3",o.isActive("closed-orders")?"":"hidden"]),role:"tabpanel",style:{"min-height":"300px"}},[p(S,{"current-page":d.currentPage,"onUpdate:currentPage":t[5]||(t[5]=A=>d.currentPage=A),class:"w-full text-left text-sm text-gray-500 dark:text-gray-400",data:o.closedOrders,"page-size":10,"hide-sort-icons":!0,onTotalPagesChanged:t[6]||(t[6]=A=>d.totalPages=A)},{head:_(()=>[a("tr",Zt,[p(l,{"sort-key":"created",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Date"})]),_:1}),p(l,{"sort-key":"order_id",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"TxHash"})]),_:1}),p(l,{"sort-key":"symbol",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Symbol"})]),_:1}),p(l,{"sort-key":"side",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Side"})]),_:1}),p(l,{"sort-key":"price",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Price"})]),_:1}),p(l,{"sort-key":"amount",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Amount"})]),_:1}),p(l,{"sort-key":"filled",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Filled"})]),_:1}),p(l,{"sort-key":"status",scope:"col",class:"py-3 px-6"},{default:_(()=>[p(n,{text:"Status"})]),_:1})])]),body:_(({rows:A})=>[o.closedOrders&&o.closedOrders.length>0?(h(!0),f(q,{key:0},J(A,w=>(h(),f("tr",{key:w.id,class:"border-b bg-white dark:border-gray-700 dark:bg-gray-800"},[a("td",Gt,[p(y,{time:w.created},null,8,["time"])]),a("td",Jt,m(w.id),1),a("td",Qt,m(w.pair),1),a("td",Xt,[w.type=="BUY"?(h(),f("span",er,m(e.$t("Buy")),1)):(h(),f("span",tr,m(e.$t("Sell")),1))]),a("td",rr,[p(v,{num:w.price,decimals:r.precisionPrice},null,8,["num","decimals"]),O(" "+m(o.pair),1)]),a("td",sr,[p(v,{num:w.amount,decimals:r.precisionAmount},null,8,["num","decimals"]),O(" "+m(o.currency),1)]),a("td",ar,[p(v,{num:w.fill,decimals:r.precisionAmount},null,8,["num","decimals"]),O(" "+m(o.currency),1)]),a("td",or,[a("span",ir,m(e.$t("Filled")),1)])]))),128)):(h(),f("tr",nr,[a("td",lr,[t[11]||(t[11]=a("div",{class:"flex w-full justify-center"},[a("img",{height:"128",width:"128",src:"https://assets.staticimg.com/pro/2.0.4/images/empty.svg",alt:""})],-1)),O(" "+m(e.$t("No Data Found")),1)])]))]),_:1},8,["current-page","data"]),p(C,{currentPage:d.currentPage,"onUpdate:currentPage":t[7]||(t[7]=A=>d.currentPage=A),class:"flex items-center justify-between p-3","aria-label":"Table navigation","total-pages":d.totalPages,"max-page-links":3,"boundary-links":!0},{firstPage:_(()=>[O(m(e.$t("First")),1)]),lastPage:_(()=>[O(m(e.$t("Last")),1)]),next:_(()=>[a("span",cr,m(e.$t("Next")),1),t[12]||(t[12]=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1))]),previous:_(()=>[a("span",dr,m(e.$t("Previous")),1),t[13]||(t[13]=a("svg",{class:"h-5 w-5","aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1))]),_:1},8,["currentPage","total-pages"])],2)])}const mr=E(Bt,[["render",ur]]),hr={name:"NewSvg",props:{path1:{type:String,required:!0},path2:{type:String,required:!1},path3:{type:String,required:!0},fill1:{type:String,required:!0},fill2:{type:String,required:!0}}},pr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},yr=["d","fill"],br=["d","fill"],gr=["d"];function fr(e,t,r,s,d,o){return h(),f("svg",pr,[a("path",{d:r.path1,fill:r.fill1},null,8,yr),a("path",{d:r.path2,fill:r.fill2},null,8,br),a("path",{d:r.path3,fill:"currentColor"},null,8,gr)])}const kr=E(hr,[["render",fr]]),vr={components:{ListItem:Se,NewSvg:kr},props:{market:{type:Object,required:!0}},setup(e){const t=j(),r=pe({limit:{asks:12,bids:12},showMoreAsks:!1,showMoreBids:!1,sideLength:20,refreshRate:500,bestAsker:0,bestAskerIcon:null,bestAskerClass:null,lastUpdated:"",activeItem:"pills-graph",data:{},asks:Array.from({length:20},()=>[0,0,0,0]),bids:Array.from({length:20},()=>[0,0,0,0])}),s=B(()=>e.market.currency),d=B(()=>e.market.pair),o=H(null),n=H([]),l={sort(i){return i.sort((u,c)=>u[1]-c[1])},median(i){const u=Math.floor(i.length/3*2);return i[u][1]<1?1:i[u][1]},medianUnit(i,u,c){const b=[...i,...u];return this.median(this.sort(b))/c},width(i,u){if(u===0)return 1;const c=Math.round(Number(i)/u);return c<=0?1:Math.min(160,c)}};function y(i,u){const c=l.medianUnit(i,u,48);i.forEach(b=>{b.push({width:l.width(b[1],c)*2.5})}),u.forEach(b=>{b.push({width:l.width(b[1],c)*2.5})})}function v(){const i=[...r.asks,...r.bids],u=l.medianUnit(r.asks,r.bids,48);i.forEach(c=>{c[1]>0&&(c[2].width=l.width(c[1],u)*2.5)})}const S={width:250,sortwidth:l,init:y};R(()=>r.asks,()=>{v()},{deep:!0}),R(()=>r.bids,()=>{v()},{deep:!0}),R(s,async()=>{n.value=[],r.bestAskerClass=null,r.bestAskerIcon=null,t.bestAsk=0,t.bestBid=0,r.bestBidder=0,r.bestAsker=0,r.asks=Array.from({length:20},()=>[0,0,0,0]),r.bids=Array.from({length:20},()=>[0,0,0,0]),await K(s.value,d.value),Z(),await Y(s.value,d.value)}),R(d,async()=>{n.value=[],r.bestAskerClass=null,r.bestAskerIcon=null,t.bestAsk=0,t.bestBid=0,r.bestBidder=0,r.bestAsker=0,r.asks=Array.from({length:20},()=>[0,0,0,0]),r.bids=Array.from({length:20},()=>[0,0,0,0]),await K(s.value,d.value),Z(),await Y(s.value,d.value)});function C(i){return activeItem===i}function A(i){activeItem=i}const w=B(()=>{const i=r.asks.slice().sort((c,b)=>{const g=parseFloat(c[0]),x=parseFloat(b[0]);return g===0&&x===0?0:g===0?-1:x===0?1:x-g});return(r.showMoreAsks?i:i.slice(-r.limit.asks)).map(([c,b,{width:g}])=>[L(c,X.value),L(b,U.value),L(c*b,U.value),g])}),Q=B(()=>r.bids.map(([i,u,{width:c}])=>[L(i,X.value),L(u,U.value),L(i*u,U.value),c]));async function K(i,u){try{const c=await axios.post("/user/eco/orderbook",{currency:i,pair:u});c.length>0&&W(c)}catch(c){$toast.error(c.message)}}async function Y(i,u){try{const b=(await axios.post("/user/eco/orderbook/history",{currency:i,pair:u})).filter(g=>!n.value.find(x=>x.id===g.id));b.length>0&&W(b),t.marketOrder=r.asks.length>0}catch{}}async function W(i){i.forEach(c=>$(c)),i=te(n.value);const u=Date.now();if(!r.lastUpdated||u-r.lastUpdated>r.refreshRate){S.init(i.bids,i.asks),i.asks.sort((x,P)=>x[0]-P[0]),i.bids.sort((x,P)=>P[0]-x[0]);const c=i.asks[0]?i.asks[0][0]:null,b=i.bids[0]?i.bids[0][0]:null,g=c&&c>r.bestAsker;r.bestAskerClass=g?"text-success":"text-danger",r.bestAskerIcon=g?"bi-arrow-up text-success":"bi-arrow-down text-danger",r.bestAsker=Number(c),t.bestAsk=Number(c),t.bestBid=Number(b),r.lastUpdated=u,k(r.asks,i.asks,r.sideLength),k(r.bids,i.bids,r.sideLength)}else await new Promise(c=>requestAnimationFrame(c)),await new Promise(c=>setTimeout(c,r.refreshRate/2))}const U=B(()=>{if(r.asks.length===0&&r.bids.length===0)return 6;const c=[...r.asks.map(b=>Number(b[1])),...r.bids.map(b=>Number(b[1]))].filter(b=>b!==0).reduce((b,g)=>{const x=(g.toString().split(".")[1]||"").length;return Math.max(b,x)},0);return t.precisionAmount=c,c}),X=B(()=>{if(r.asks.length===0&&r.bids.length===0)return 8;const c=[...r.asks.map(b=>Number(b[0])),...r.bids.map(b=>Number(b[0]))].filter(b=>b!==0).reduce((b,g)=>{const x=(g.toString().split(".")[1]||"").length;return Math.max(b,x)},0);return t.precisionPrice=c,c});function L(i,u=8,c=","){return isNaN(i)?"0":(u=parseInt(u),i=Number(i).toFixed(u),i)}function Z(){M();const i=`orderbook-data.${s.value}.${d.value}`;o.value=window.Echo.private(i),o.value.listen(".orderbook-deleted",async u=>{ee(u.order)}),o.value.listen(".orderbook",async u=>{z(u.orderbook)})}function ee(i){n.value=n.value.filter(u=>u.id!==i),["asks","bids"].forEach(u=>{const c=r[u].findIndex(([b,,,g])=>g===i);c!==-1&&r[u].splice(c,1)}),W(n.value)}function z(i){const u=i.type==="BUY"?"SELL":"BUY";n.value=n.value.filter(g=>g.amount-g.fill>0);const c=n.value.filter(g=>g.type===u).sort((g,x)=>g.price-x.price),b=c.findIndex(g=>Math.abs(g.price-i.price)<1e-8);if(b!==-1){const g=c[b],x=Number(i.amount)-Number(i.fill),P=Number(g.amount)-Number(g.fill);if(x>=P){i.fill+=P;const G=n.value.indexOf(g);G!==-1&&n.value.splice(G,1);const V=u==="BUY"?"bids":"asks",se=r[V].findIndex(ae=>Math.abs(ae[0]-g.price)<1e-8);se!==-1&&(r[V]=JSON.parse(JSON.stringify(r[V].filter((ae,ne)=>ne!==se))))}else g.fill+=x,i.fill=i.amount}i.fill<i.amount&&n.value.push(i),W(n.value)}function $(i){const u=n.value.findIndex(c=>c.id===i.id);u!==-1?n.value[u]=i:n.value.push(i)}function te(i){let u={},c={};Array.isArray(i)||(i=[i]),i.forEach(g=>{if(g.price){let x=Number(g.price).toFixed(8),P=g.type==="BUY"?u:c;P[x]?P[x][1]=(Number(P[x][1])+Number(g.amount)).toFixed(8):P[x]=[x,Number(g.amount-g.fill).toFixed(8)]}});const b=(g,x)=>{let P=Object.values(g);return P.sort((G,V)=>{if(x==="PRICE_ASC")return parseFloat(G[0])>parseFloat(V[0])?1:-1;if(x==="PRICE_DESC")return parseFloat(G[0])<parseFloat(V[0])?1:-1}),P};return{bids:b(u,"PRICE_DESC"),asks:b(c,"PRICE_ASC")}}function k(i,u,c){u.forEach(b=>{const g=i.findIndex(x=>x[0]===b[0]);g>=0?i.splice(g,1,b):i.push(b)}),i.sort((b,g)=>g[0]-b[0]),i.splice(c)}ie(()=>{K(s.value,d.value),Z(),Y(s.value,d.value)});function M(){o.value&&(window.Echo.leave(`orderbook-data.${s.value}.${d.value}`),o.value=null)}return ye(()=>{M()}),{ecoStore:t,state:r,currency:s,pair:d,formattedAsks:w,formattedBids:Q,isActive:C,setActive:A}}},_r={class:"Orderbook border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"},xr={class:"flex p-1 xs:hidden md:flex",role:"tablist"},wr={class:"p-1"},Sr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Ar={class:"p-1"},Fr={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Tr={class:"p-1"},Br={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",class:"css-3kwgah",style:{margin:"0px","min-width":"0px","font-size":"24px",width:"1em",height:"1em"}},Cr={key:0,class:"Asks"},Or={style:{"overflow-x":"hidden"}},Mr={class:""},Pr={class:"text-start",style:{"padding-left":"5px"},scope:"col"},Ir={class:"text-end",style:{"padding-right":"5px"},scope:"col"},Nr={class:"LastPrice xs:hidden md:block"},Dr={class:"p-3"},Er={key:1,class:"Bids"},Lr={style:{"overflow-x":"hidden"}},Wr={key:0,class:""},$r={class:"pl-2 text-start",scope:"col"},Ur={class:"text-center if-sm",scope:"col"},zr={class:"text-end",scope:"col"},Vr={key:1,class:"xs:flex md:hidden"},Hr={class:"pl-2 text-start",scope:"col"},Rr={class:"text-center if-sm",scope:"col"},qr={class:"text-end",scope:"col"};function jr(e,t,r,s,d,o){const n=F("ListItem");return h(),f("div",_r,[a("ul",xr,[a("li",wr,[a("button",{class:T({"text-gray-200 dark:text-gray-600":s.state.showMoreAsks||s.state.showMoreBids||s.state.showMoreAsks&&s.state.showMoreBids}),onClick:t[0]||(t[0]=D(l=>(s.state.showMoreAsks=!1,s.state.showMoreBids=!1,s.state.limit.asks=12,s.state.limit.bids=12),["prevent"]))},[(h(),f("svg",Sr,t[3]||(t[3]=[a("path",{d:"M4 4h7v7H4V4z",fill:"#F6465D"},null,-1),a("path",{d:"M4 13h7v7H4v-7z",fill:"#0ECB81"},null,-1),a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1)])))],2)]),a("li",Ar,[a("button",{class:T({"text-gray-200 dark:text-gray-600":!s.state.showMoreBids||s.state.showMoreAsks}),onClick:t[1]||(t[1]=D(l=>(s.state.showMoreAsks=!1,s.state.showMoreBids=!0,s.state.limit.asks=0,s.state.limit.bids=20),["prevent"]))},[(h(),f("svg",Fr,t[4]||(t[4]=[a("path",{d:"M4 4h7v16H4V4z",fill:"#0ECB81"},null,-1),a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1)])))],2)]),a("li",Tr,[a("button",{class:T({"text-gray-200 dark:text-gray-600":s.state.showMoreBids||!s.state.showMoreAsks}),onClick:t[2]||(t[2]=D(l=>(s.state.showMoreAsks=!0,s.state.showMoreBids=!1,s.state.limit.asks=20,s.state.limit.bids=0),["prevent"]))},[(h(),f("svg",Br,t[5]||(t[5]=[a("path",{d:"M4 4h7v16H4V4z",fill:"#F6465D"},null,-1),a("path",{d:"M13 4h7v4h-7V4zm0 6h7v4h-7v-4zm7 6h-7v4h7v-4z",fill:"currentColor"},null,-1)])))],2)])]),(h(),f("div",{key:s.state.limit.asks,class:"OrderbookGrid"},[s.state.limit.asks!=0?(h(),f("div",Cr,[a("table",Or,[a("thead",Mr,[a("th",Pr,m(e.$t("Price")),1),t[6]||(t[6]=a("th",{class:"text-center if-sm",scope:"col"},"Amount",-1)),a("th",Ir,m(e.$t("Total")),1)]),a("tbody",null,[(h(),N(n,{key:s.state.showMoreBids,data:s.formattedAsks,type:"ask","show-less":s.state.showMoreBids,limit:s.state.limit.asks},null,8,["data","show-less","limit"]))])])])):I("",!0),a("div",Nr,[a("div",Dr,[t[7]||(t[7]=a("span",{class:""},"Last Price: ",-1)),a("span",{class:T(s.state.bestAskerClass)},m(s.state.bestAsker??0),3),a("i",{class:T(["bi",s.state.bestAskerIcon])},null,2)])]),s.state.limit.bids!=0?(h(),f("div",Er,[a("table",Lr,[s.state.limit.asks==0?(h(),f("thead",Wr,[a("th",$r,m(e.$t("Price")),1),a("th",Ur,m(e.$t("Amount")),1),a("th",zr,m(e.$t("Total")),1)])):I("",!0),s.state.limit.asks!=0?(h(),f("thead",Vr,[a("th",Hr,m(e.$t("Price")),1),a("th",Rr,m(e.$t("Amount")),1),a("th",qr,m(e.$t("Total")),1)])):I("",!0),a("tbody",null,[(h(),N(n,{key:s.state.showMoreAsks,data:s.formattedBids,type:"bid","show-less":s.state.showMoreAsks,limit:s.state.limit.bids},null,8,["data","show-less","limit"]))])])])):I("",!0)]))])}const Kr=E(vr,[["render",jr]]);const Yr={components:{Markets:ce,EcoMarkets:Pe,Trades:Ye,Charting:Je,Order:Tt,Orders:mr,Orderbook:Kr},setup(){return{ecoStore:j()}},data(){return{symbol:this.$route.params.symbol,currency:this.$route.params.currency,index:0,plat,ext}},watch:{async $route(e,t){this.fetchData()}},created(){this.fetchData()},methods:{getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},async fetchData(){await this.ecoStore.fetch(this.$route.params.symbol,this.$route.params.currency)},isActive(e){return this.activeItem===e},setActive(e){this.activeItem=e}}},Zr={class:"EcoContainer",style:{margin:"-18px -20px 3px -20px"}},Gr={id:"creatable",class:"Chart border border-gray-100 bg-white shadow dark:border-gray-700 dark:bg-gray-900"};function Jr(e,t,r,s,d,o){const n=F("EcoMarkets"),l=F("Markets"),y=F("Trades"),v=F("Charting"),S=F("Order"),C=F("Orderbook"),A=F("Orders");return h(),f("div",null,[a("div",Zr,[d.ext.eco==1&&d.plat.eco.ecosystem_trading_only==1?(h(),N(n,{key:0,style:{"overflow-y":"auto","overflow-x":"hidden"},type:"trade",subtype:"non"})):(h(),N(l,{key:1,style:{"overflow-y":"auto","overflow-x":"hidden"},type:"trade",subtype:"non"})),s.ecoStore.market.length!=0?(h(),N(y,{key:2,market:s.ecoStore.market,"precision-amount":s.ecoStore.precisionAmount,"precision-price":s.ecoStore.precisionPrice},null,8,["market","precision-amount","precision-price"])):I("",!0),a("div",Gr,[s.ecoStore.market.length!=0?(h(),N(v,{key:s.ecoStore.market.currency+s.ecoStore.market.pair,market:s.ecoStore.market},null,8,["market"])):I("",!0)]),s.ecoStore.market.length!=0?(h(),N(S,{key:3,market:s.ecoStore.market},null,8,["market"])):I("",!0),s.ecoStore.market.length!=0?(h(),N(C,{key:4,market:s.ecoStore.market},null,8,["market"])):I("",!0)]),s.ecoStore.market.length!=0?(h(),N(A,{key:0,market:s.ecoStore.market,"precision-amount":s.ecoStore.precisionAmount,"precision-price":s.ecoStore.precisionPrice},null,8,["market","precision-amount","precision-price"])):I("",!0)])}const ys=E(Yr,[["render",Jr]]);export{ys as default};
