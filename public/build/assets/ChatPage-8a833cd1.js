import{_ as y,W as b,r as k,o as l,c as d,a as s,t as g,i as _,w as x,g as v,F as u,b as w,n as m,f as I,q as h,h as p,U as M,v as L}from"./bootstrap-249b0f62.js";import"./_commonjsHelpers-de833af9.js";import"./dijkstra-f906a09e.js";import"./preload-helper-f61836a9.js";import"./axios-7a713374.js";const T={data(){return{ticket:[],chatTitle:"",newMessage:"",messages:[],uploadedImageUrl:"",showingLargeImage:!1,largeImageUrl:"",isMouseOverImage:!1}},created(){this.loadTicket()},methods:{showLargeImage(r){const e=this.extractImageUrl(r);e&&(this.showingLargeImage=!0,this.largeImageUrl=e)},hideLargeImage(){this.showingLargeImage=!1},extractImageUrl(r){const e=document.createElement("div");e.innerHTML=r;const t=e.querySelector("img");return t?t.src:""},async uploadImage(r){const e=r.target.files[0];if(e){const t=new FormData;t.append("image",e);try{const o=await axios.post("/user/support/tickets/upload-image",t,{headers:{"Content-Type":"multipart/form-data"}});o.status==="success"?(this.uploadedImageUrl=o.image_url,this.sendImage()):this.$toast.error(o.message)}catch(o){console.error(o)}}},sendImage(){if(this.uploadedImageUrl){const r={ticket_id:this.ticket.id,sender_name:this.ticket.user.username,type:"image",content:`<img src="${this.uploadedImageUrl}" class="uploaded-image" />`,timestamp:new Date().toISOString()};axios.post(`/user/support/tickets/${this.ticket.id}/send`,{data:r}),this.uploadedImageUrl="",this.$nextTick(()=>{const e=this.$el.querySelectorAll(".uploaded-image"),t=e[e.length-1];t&&t.addEventListener("click",this.expandImage)})}},expandImage(r){const e=r.target;e.classList.toggle("expanded"),e.classList.contains("expanded")?(e.style.maxWidth="90%",e.style.cursor="zoom-out"):(e.style.maxWidth="100%",e.style.cursor="zoom-in")},async loadTicket(){await axios.get(`/user/support/tickets/${this.$route.params.id}/messages`).then(o=>{o.type=="success"?(this.ticket=o.ticket,this.messages=Array.isArray(o.ticket.messages)?o.ticket.messages:[]):(this.$toast.error(o.message),this.$router.push("/support"))}).catch(o=>{console.error(o)});const r=new b(PUSHER_APP_KEY,{cluster:PUSHER_APP_CLUSTER,forceTLS:!0,authEndpoint:"/user/pusher/auth",auth:{headers:{"X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},beforeSend:function(o){o.setRequestHeader("X-CSRF-Token",document.querySelector('meta[name="csrf-token"]').getAttribute("content"))}}}),e=`support-private-chat-${this.ticket.id}`;r.subscribe(e).bind("new_message",o=>{this.messages.push(o)}),this.chatTitle=`Ticket #${this.ticket.id}`},messageClass(r){return r===this.ticket.user_id?"my-message text-right":"other-message text-left"},sendMessage(){if(this.newMessage.trim()==="")return;const r={ticket_id:this.ticket.id,sender_name:this.ticket.user.username,content:this.newMessage.trim(),type:"text",timestamp:new Date().toISOString()};Array.isArray(this.messages)||(this.messages=[]),axios.post(`/user/support/tickets/${this.ticket.id}/send`,{data:r}),this.newMessage=""},formatDate(r){const e=Math.floor((new Date-r)/1e3);let t=Math.floor(e/31536e3);return t>=1?`${t} year${t===1?"":"s"} ago`:(t=Math.floor(e/2592e3),t>=1?`${t} month${t===1?"":"s"} ago`:(t=Math.floor(e/86400),t>=1?`${t} day${t===1?"":"s"} ago`:(t=Math.floor(e/3600),t>=1?`${t} hour${t===1?"":"s"} ago`:(t=Math.floor(e/60),t>=1?`${t} minute${t===1?"":"s"} ago`:"just now"))))}}},S={class:"mb-5 flex justify-between"},C={class:"text-xl font-semibold text-gray-700 dark:text-gray-200"},U={class:"card pt-4"},A={ref:"chatMessages",class:"card-body flex-grow overflow-y-auto px-4 pb-4 dark:bg-gray-800"},D={key:0,class:"space-y-3"},P={class:"meta mb-1 text-sm text-gray-500 dark:text-gray-400"},E={key:0,class:"sender mr-2"},$={class:"timestamp"},q={key:0},F={class:"image-container"},H=["innerHTML"],N=["onClick"],R={key:1},z={key:1},O={class:"card-body flex-grow space-y-4 overflow-y-auto px-4 pb-4 dark:bg-gray-800"},V={class:"text-center text-gray-500 dark:text-gray-200"},B={class:"mt-2"},j={class:"relative w-full ml-4"},W={key:1,class:"card-footer"},X={class:"relative flex items-center"},K={class:"text-gray-500 dark:text-gray-200"},Y=["src"];function G(r,e,t,o,i,n){const f=k("router-link");return l(),d(u,null,[s("div",S,[s("h3",C,g(i.chatTitle),1),_(f,{to:"/support",class:"btn btn-outline-secondary"},{default:x(()=>[e[7]||(e[7]=s("i",{class:"bi bi-chevron-left"},null,-1)),v(" "+g(r.$t("Back")),1)]),_:1})]),s("div",U,[s("div",A,[i.messages!=null&&i.messages.length>0?(l(),d("div",D,[(l(!0),d(u,null,w(i.messages,a=>(l(),d("div",{key:a.id},[s("div",{class:m(n.messageClass(a.sender_id))},[s("div",P,[a.sender_id!==i.ticket.user_id?(l(),d("span",E,g(a.sender_name),1)):I("",!0),s("span",$,g(n.formatDate(a.timestamp)),1)]),s("div",{class:m(["content max-w-3/4 inline-block break-words px-4 py-2 shadow-md",a.sender_id===i.ticket.user_id?"rounded-tl-lg rounded-b-lg bg-blue-500 text-white":"rounded-tr-lg rounded-b-lg bg-gray-300 text-gray-700"])},[a.type==="image"?(l(),d("div",q,[s("div",F,[s("div",{class:"image-wrapper",ref_for:!0,ref:"messageImage",onMouseover:e[0]||(e[0]=c=>i.isMouseOverImage=!0),onMouseout:e[1]||(e[1]=c=>i.isMouseOverImage=!1),innerHTML:a.content},null,40,H),s("div",{class:"overlay",onClick:c=>n.showLargeImage(a.content)},e[8]||(e[8]=[s("i",{class:"bi bi-zoom-in zoom-icon"},null,-1)]),8,N)])])):(l(),d("div",R,g(a.content),1))],2)],2)]))),128))])):(l(),d("div",z,[s("div",O,[s("div",V,g(r.$t("No Messages Found!")),1)])]))],512),i.ticket.status!=3?(l(),d("form",{key:0,class:"card-footer flex items-center justify-between",onSubmit:e[4]||(e[4]=h((...a)=>n.sendMessage&&n.sendMessage(...a),["prevent"]))},[s("div",B,[e[9]||(e[9]=s("label",{for:"image-upload",class:"text-gray-500 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"},[s("i",{class:"bi bi-image"})],-1)),s("input",{type:"file",id:"image-upload",class:"hidden",onChange:e[2]||(e[2]=(...a)=>n.uploadImage&&n.uploadImage(...a))},null,32)]),s("div",j,[p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>i.newMessage=a),type:"text",class:"block w-full p-3 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Type a message..."},null,512),[[M,i.newMessage]]),e[10]||(e[10]=s("button",{type:"submit",class:"text-white absolute right-2.5 bottom-2.5 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium text-sm dark:focus:ring-blue-800 hover:text-blue-500"},[s("i",{class:"bi bi-send"})],-1))])],32)):(l(),d("div",W,[s("div",X,[s("div",K,g(r.$t("This ticket has been closed")),1)])]))]),p(s("div",{class:"large-image-overlay",onClick:e[6]||(e[6]=(...a)=>n.hideLargeImage&&n.hideLargeImage(...a))},[s("img",{src:i.largeImageUrl,class:"large-image"},null,8,Y),s("button",{class:"close-btn absolute top-0 right-0 text-white text-2xl focus:outline-none px-3 py-1 m-1 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 hover:dark:bg-gray-800",onClick:e[5]||(e[5]=h((...a)=>n.hideLargeImage&&n.hideLargeImage(...a),["stop"]))}," Ã— ")],512),[[L,i.showingLargeImage]])],64)}const se=y(T,[["render",G],["__scopeId","data-v-cd59216e"]]);export{se as default};
